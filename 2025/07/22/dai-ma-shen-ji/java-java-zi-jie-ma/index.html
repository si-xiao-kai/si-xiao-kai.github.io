<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Java-Java字节码, Hacker进化论">
    <meta name="description" content="本文主要介绍Java字节码的相关内容。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Java-Java字节码 | Hacker进化论</title>
    <link rel="icon" type="image/png" href="/hacker1.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Hacker进化论" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/medias/incognito.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hacker进化论</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/medias/incognito.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hacker进化论</div>
        <div class="logo-desc">
            
            The only way to do great work is to love what you do.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/si-xiao-kai/si-xiao-kai.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/si-xiao-kai/si-xiao-kai.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/7.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Java-Java字节码</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">
                                <span class="chip bg-color">Java代码审计</span>
                            </a>
                        
                            <a href="/tags/Java%E5%AD%97%E8%8A%82%E7%A0%81/">
                                <span class="chip bg-color">Java字节码</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="post-category">
                                代码审计
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-07-22
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2025-07-23
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    20.2k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    89 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="一、Java字节码概述"><a href="#一、Java字节码概述" class="headerlink" title="一、Java字节码概述"></a>一、Java字节码概述</h1><p>Java源文件(<code>*.java</code>)通过编译后会变成<code>class文件</code>，<code>class文件</code>有固定的二进制格式，<code>class文件</code>的结构在JVM虚拟机规范<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html">第四章：The class File Format</a>中有详细的说明。本章节将学习<code>class文件结构</code>、<code>class文件解析</code>、<code>class文件反编译</code>以及<code>ASM字节码库</code>。</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/">Java语言和JVM虚拟机规范</a>：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jls/se15/jls15.pdf">《Java15语言规范》</a>、<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/jvms15.pdf">《Java15虚拟机实现规范》</a></p>
<ul>
<li><strong>示例代码TestHelloWorld:</strong></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>classloader</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Creator: yz
 * Date: 2019/12/17
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestHelloWorld</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"Hello World~"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>TestHelloWorld.java编译解析流程：</strong></li>
</ul>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201015170935576.png" style="zoom:67%;">

<ul>
<li><strong>TestHelloWorld.java 源码、字节码：</strong></li>
</ul>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201014104801579.png" style="zoom:67%;">

<h1 id="二、-Java-class文件格式"><a href="#二、-Java-class文件格式" class="headerlink" title="二、 Java class文件格式"></a>二、 Java class文件格式</h1><p>⚠️：用010editor能够直观看到二进制数据每个数据块的语义和值，可以对照学习。</p>
<p>在<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html">JVM虚拟机规范第四章</a>中规定了class文件必须是一个固定的结构，如下所示：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ClassFile</span> <span class="token punctuation">{</span>
    u4 magic<span class="token punctuation">;</span>
    u2 minor_version<span class="token punctuation">;</span>
    u2 major_version<span class="token punctuation">;</span>
    u2 constant_pool_count<span class="token punctuation">;</span>
    cp_info constant_pool<span class="token punctuation">[</span>constant_pool_count<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    u2 access_flags<span class="token punctuation">;</span>
    u2 this_class<span class="token punctuation">;</span>
    u2 super_class<span class="token punctuation">;</span>
    u2 interfaces_count<span class="token punctuation">;</span>
    u2 interfaces<span class="token punctuation">[</span>interfaces_count<span class="token punctuation">]</span><span class="token punctuation">;</span>
    u2 fields_count<span class="token punctuation">;</span>
    field_info fields<span class="token punctuation">[</span>fields_count<span class="token punctuation">]</span><span class="token punctuation">;</span>
    u2 methods_count<span class="token punctuation">;</span>
    method_info methods<span class="token punctuation">[</span>methods_count<span class="token punctuation">]</span><span class="token punctuation">;</span>
    u2 attributes_count<span class="token punctuation">;</span>
    attribute_info attributes<span class="token punctuation">[</span>attributes_count<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在JVM规范中<code>u1</code>、<code>u2</code>、<code>u4</code>分别表示的是1、2、4个字节的无符号数，可使用<code>java.io.DataInputStream</code>类中的对应方法：<code>readUnsignedByte</code>、<code>readUnsignedShort</code>、<code>readInt</code>方法读取。除此之外，表结构(<code>table</code>)由任意数量的可变长度的项组成，用于表示class中的复杂结构，如上述的：<code>cp_info</code>、<code>field_info</code>、<code>method_info</code>、<code>attribute_info</code>。</p>
<p><strong>TestHelloWorld.class十六进制：</strong></p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201014142251979.png" alt="img"></p>
<h2 id="2-1-Magic（魔数）"><a href="#2-1-Magic（魔数）" class="headerlink" title="2.1 Magic（魔数）"></a>2.1 Magic（魔数）</h2><p>魔数是class文件的标识符，固定值为<code>0xCAFEBABE</code>，JVM加载class文件时会先读取4字节（<code>u4 magic;</code>）的魔数信息校验是否是一个class文件。</p>
<h2 id="2-2-Minor-Major-Version（版本号"><a href="#2-2-Minor-Major-Version（版本号" class="headerlink" title="2.2 Minor/Major Version（版本号)"></a>2.2 Minor/Major Version（版本号)</h2><p>class文件的版本号由两个<code>u2</code>组成（<code>u2 minor_version; u2 major_version;</code>），分别表示的是<code>minor_version</code>（副版本号）、<code>major_version</code> （主版本号），我们常说的<code>JDK1.8</code>、<code>Java9</code>等说的就是主版本号，如上图中的<code>TestHelloWorld.class</code>的版本号<code>0x34</code>即<code>JDK1.8</code>。</p>
<p><strong>Java版本对应表：</strong></p>
<table>
<thead>
<tr>
<th>JDK版本</th>
<th><strong>十进制</strong></th>
<th><strong>十六进制</strong></th>
<th>发布时间</th>
</tr>
</thead>
<tbody><tr>
<td>JDK1.1</td>
<td>45</td>
<td>2D</td>
<td>1996-05</td>
</tr>
<tr>
<td>JDK1.2</td>
<td>46</td>
<td>2E</td>
<td>1998-12</td>
</tr>
<tr>
<td>JDK1.3</td>
<td>47</td>
<td>2F</td>
<td>2000-05</td>
</tr>
<tr>
<td>JDK1.4</td>
<td>48</td>
<td>30</td>
<td>2002-02</td>
</tr>
<tr>
<td>JDK1.5</td>
<td>49</td>
<td>31</td>
<td>2004-09</td>
</tr>
<tr>
<td>JDK1.6</td>
<td>50</td>
<td>32</td>
<td>2006-12</td>
</tr>
<tr>
<td>JDK1.7</td>
<td>51</td>
<td>33</td>
<td>2011-07</td>
</tr>
<tr>
<td>JDK1.8</td>
<td>52</td>
<td>34</td>
<td>2014-03</td>
</tr>
<tr>
<td>Java9</td>
<td>53</td>
<td>35</td>
<td>2017-09</td>
</tr>
<tr>
<td>Java10</td>
<td>54</td>
<td>36</td>
<td>2018-03</td>
</tr>
<tr>
<td>Java11</td>
<td>55</td>
<td>37</td>
<td>2018-09</td>
</tr>
<tr>
<td>Java12</td>
<td>56</td>
<td>38</td>
<td>2019-03</td>
</tr>
<tr>
<td>Java13</td>
<td>57</td>
<td>39</td>
<td>2019-09</td>
</tr>
<tr>
<td>Java14</td>
<td>58</td>
<td>3A</td>
<td>2020-03</td>
</tr>
<tr>
<td>Java15</td>
<td>59</td>
<td>3B</td>
<td>2020-09</td>
</tr>
<tr>
<td>Java16</td>
<td>60</td>
<td>3C</td>
<td>2021-03</td>
</tr>
<tr>
<td>Java17</td>
<td>61</td>
<td>3D</td>
<td>2021-09</td>
</tr>
<tr>
<td>Java18</td>
<td>62</td>
<td>3E</td>
<td>2022-03</td>
</tr>
<tr>
<td>Java19</td>
<td>63</td>
<td>3F</td>
<td>2022-09</td>
</tr>
</tbody></table>
<h2 id="2-3-constant-pool-count-（常量池计数器）"><a href="#2-3-constant-pool-count-（常量池计数器）" class="headerlink" title="2.3 constant_pool_count （常量池计数器）"></a>2.3 constant_pool_count （常量池计数器）</h2><p><code>u2 constant_pool_count;</code>表示的是常量池中的数量，<code>constant_pool_count</code>的值等于常量池中的数量加1，需要特别注意的是<code>long</code>和<code>double</code>类型的常量池对象占用两个常量位。</p>
<h2 id="2-4-constant-pool（常量池）"><a href="#2-4-constant-pool（常量池）" class="headerlink" title="2.4 constant_pool（常量池）"></a>2.4 constant_pool（常量池）</h2><p><code>cp_info constant_pool[constant_pool_count-1];</code>是一种表结构，<code>cp_info</code>表示的是常量池对象。</p>
<p><strong><code>cp_info</code>数据结构：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">cp_info {
   u1 tag;
   u1 info[];
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>u1 tag;</code>表示的是常量池中的存储类型，常量池中的<code>tag</code>说明：</p>
<table>
<thead>
<tr>
<th><strong>常量池类型</strong></th>
<th>Tag</th>
<th>章节</th>
</tr>
</thead>
<tbody><tr>
<td>CONSTANT_Utf8</td>
<td>1</td>
<td>§4.4.7</td>
</tr>
<tr>
<td>CONSTANT_Integer</td>
<td>3</td>
<td>§4.4.4</td>
</tr>
<tr>
<td>CONSTANT_Float</td>
<td>4</td>
<td>§4.4.4</td>
</tr>
<tr>
<td>CONSTANT_Long</td>
<td>5</td>
<td>§4.4.5</td>
</tr>
<tr>
<td>CONSTANT_Double</td>
<td>6</td>
<td>§4.4.5</td>
</tr>
<tr>
<td>CONSTANT_Class</td>
<td>7</td>
<td>§4.4.1</td>
</tr>
<tr>
<td>CONSTANT_String</td>
<td>8</td>
<td>§4.4.3</td>
</tr>
<tr>
<td>CONSTANT_Fieldref</td>
<td>9</td>
<td>§4.4.2</td>
</tr>
<tr>
<td>CONSTANT_Methodref</td>
<td>10</td>
<td>§4.4.2</td>
</tr>
<tr>
<td>CONSTANT_InterfaceMethodref</td>
<td>11</td>
<td>§4.4.2</td>
</tr>
<tr>
<td>CONSTANT_NameAndType</td>
<td>12</td>
<td>§4.4.6</td>
</tr>
<tr>
<td>CONSTANT_MethodHandle</td>
<td>15</td>
<td>§4.4.8</td>
</tr>
<tr>
<td>CONSTANT_MethodType</td>
<td>16</td>
<td>§4.4.9</td>
</tr>
<tr>
<td>CONSTANT_Dynamic</td>
<td>17</td>
<td>§4.4.10</td>
</tr>
<tr>
<td>CONSTANT_InvokeDynamic</td>
<td>18</td>
<td>§4.4.10</td>
</tr>
<tr>
<td>CONSTANT_Module</td>
<td>19</td>
<td>§4.4.11</td>
</tr>
<tr>
<td>CONSTANT_Package</td>
<td>20</td>
<td>§4.4.12</td>
</tr>
</tbody></table>
<p>每一种<code>tag</code>都对应了不同的数据结构，上述表格中标记了不同类型的tag值以及对应的<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.4">JVM规范章节</a>。</p>
<h2 id="2-5-access-flags-（访问标志）"><a href="#2-5-access-flags-（访问标志）" class="headerlink" title="2.5 access_flags （访问标志）"></a>2.5 access_flags （访问标志）</h2><p><code>u2 access_flags;</code>，表示的是某个类或者接口的访问权限及属性。</p>
<table>
<thead>
<tr>
<th>标志名</th>
<th>十六进制值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>ACC_PUBLIC</td>
<td>0x0001</td>
<td>声明为public</td>
</tr>
<tr>
<td>ACC_FINAL</td>
<td>0x0010</td>
<td>声明为final</td>
</tr>
<tr>
<td>ACC_SUPER</td>
<td>0x0020</td>
<td>废弃/仅JDK1.0.2前使用</td>
</tr>
<tr>
<td>ACC_INTERFACE</td>
<td>0x0200</td>
<td>声明为接口</td>
</tr>
<tr>
<td>ACC_ABSTRACT</td>
<td>0x0400</td>
<td>声明为abstract</td>
</tr>
<tr>
<td>ACC_SYNTHETIC</td>
<td>0x1000</td>
<td>声明为synthetic，表示该class文件并非由Java源代码所生成</td>
</tr>
<tr>
<td>ACC_ANNOTATION</td>
<td>0x2000</td>
<td>标识注解类型</td>
</tr>
<tr>
<td>ACC_ENUM</td>
<td>0x4000</td>
<td>标识枚举类型</td>
</tr>
</tbody></table>
<h2 id="2-6-this-class（当前类名称）"><a href="#2-6-this-class（当前类名称）" class="headerlink" title="2.6 this_class（当前类名称）"></a>2.6 this_class（当前类名称）</h2><p><code>u2 this_class;</code>表示的是当前class文件的类名所在常量池中的索引位置。</p>
<h2 id="2-7-super-class（当前类的父类名称）"><a href="#2-7-super-class（当前类的父类名称）" class="headerlink" title="2.7 super_class（当前类的父类名称）"></a>2.7 super_class（当前类的父类名称）</h2><p><code>u2 super_class;</code>表示的是当前class文件的父类类名所在常量池中的索引位置。<code>java/lang/Object</code>类的<code>super_class</code>的为0，其他任何类的<code>super_class</code>都必须是一个常量池中存在的索引位置。</p>
<h2 id="2-8-interfaces-count（当前类继承或实现的接口数）"><a href="#2-8-interfaces-count（当前类继承或实现的接口数）" class="headerlink" title="2.8 interfaces_count（当前类继承或实现的接口数）"></a>2.8 interfaces_count（当前类继承或实现的接口数）</h2><p><code>u2 interfaces_count;</code>表示的是当前类继承或实现的接口数。</p>
<h2 id="2-9-interfaces-（接口名称数组）"><a href="#2-9-interfaces-（接口名称数组）" class="headerlink" title="2.9 interfaces[] （接口名称数组）"></a>2.9 interfaces[] （接口名称数组）</h2><p><code>u2 interfaces[interfaces_count];</code>表示的是所有接口数组。</p>
<h2 id="2-10-fields-count（当前类的成员变量数）"><a href="#2-10-fields-count（当前类的成员变量数）" class="headerlink" title="2.10 fields_count（当前类的成员变量数）"></a>2.10 fields_count（当前类的成员变量数）</h2><p><code>u2 fields_count;</code>表示的是当前class中的成员变量个数。</p>
<h2 id="2-11-fields-（成员变量数组）"><a href="#2-11-fields-（成员变量数组）" class="headerlink" title="2.11 fields[]（成员变量数组）"></a>2.11 fields[]（成员变量数组）</h2><p><code>field_info fields[fields_count];</code>表示的是当前类的所有成员变量，<code>field_info</code>表示的是成员变量对象。</p>
<p><strong>field_info数据结构：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">field_info {
   u2 access_flags;
   u2 name_index;
   u2 descriptor_index;
   u2 attributes_count;
   attribute_info attributes[attributes_count];
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>属性结构：</strong></p>
<ol>
<li><code>u2 access_flags;</code>表示的是成员变量的修饰符；</li>
<li><code>u2 name_index;</code>表示的是成员变量的名称；</li>
<li><code>u2 descriptor_index;</code>表示的是成员变量的描述符；</li>
<li><code>u2 attributes_count;</code>表示的是成员变量的属性数量；</li>
<li><code>attribute_info attributes[attributes_count];</code>表示的是成员变量的属性信息；</li>
</ol>
<h2 id="2-12-methods-count（当前类的成员方法数）"><a href="#2-12-methods-count（当前类的成员方法数）" class="headerlink" title="2.12 methods_count（当前类的成员方法数）"></a>2.12 methods_count（当前类的成员方法数）</h2><p><code>u2 methods_count;</code>表示的是当前class中的成员方法个数。</p>
<h2 id="2-13-methods-（成员方法数组）"><a href="#2-13-methods-（成员方法数组）" class="headerlink" title="2.13 methods[]（成员方法数组）"></a>2.13 methods[]（成员方法数组）</h2><p><code>method_info methods[methods_count];</code>表示的是当前class中的所有成员方法，<code>method_info</code>表示的是成员方法对象。</p>
<p><strong>method_info数据结构：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">method_info {
   u2 access_flags;
   u2 name_index;
   u2 descriptor_index;
   u2 attributes_count;
   attribute_info attributes[attributes_count];
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>属性结构：</strong></p>
<ol>
<li><code>u2 access_flags;</code>表示的是成员方法的修饰符；</li>
<li><code>u2 name_index;</code>表示的是成员方法的名称；</li>
<li><code>u2 descriptor_index;</code>表示的是成员方法的描述符；</li>
<li><code>u2 attributes_count;</code>表示的是成员方法的属性数量；</li>
<li><code>attribute_info attributes[attributes_count];</code>表示的是成员方法的属性信息；</li>
</ol>
<h2 id="2-14-attributes-count-（当前类的属性数）"><a href="#2-14-attributes-count-（当前类的属性数）" class="headerlink" title="2.14 attributes_count （当前类的属性数）"></a>2.14 attributes_count （当前类的属性数）</h2><p><code>u2 attributes_count;</code>表示当前class文件属性表的成员个数。</p>
<h2 id="2-15-attributes-（属性数组）"><a href="#2-15-attributes-（属性数组）" class="headerlink" title="2.15 attributes[]（属性数组）"></a>2.15 attributes[]（属性数组）</h2><p><code>attribute_info attributes[attributes_count];</code>表示的是当前class文件的所有属性，<code>attribute_info</code>是一个非常复杂的数据结构，存储着各种属性信息。</p>
<p><strong><code>attribute_info</code>数据结构：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">attribute_info {
   u2 attribute_name_index;
   u4 attribute_length;
   u1 info[attribute_length];
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>u2 attribute_name_index;</code>表示的是属性名称索引，读取<code>attribute_name_index</code>值所在常量池中的名称可以得到属性名称。</p>
<p><strong>Java15属性表：</strong></p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>章节</th>
</tr>
</thead>
<tbody><tr>
<td>ConstantValue Attribute</td>
<td>§4.7.2</td>
</tr>
<tr>
<td>Code Attribute</td>
<td>§4.7.3</td>
</tr>
<tr>
<td>StackMapTable Attribute</td>
<td>§4.7.4</td>
</tr>
<tr>
<td>Exceptions Attribute</td>
<td>§4.7.5</td>
</tr>
<tr>
<td>InnerClasses Attribute</td>
<td>§4.7.6</td>
</tr>
<tr>
<td>EnclosingMethod Attribute</td>
<td>§4.7.7</td>
</tr>
<tr>
<td>Synthetic Attribute</td>
<td>§4.7.8</td>
</tr>
<tr>
<td>Signature Attribute</td>
<td>§4.7.9</td>
</tr>
<tr>
<td>SourceFile Attribute</td>
<td>§4.7.10</td>
</tr>
<tr>
<td>SourceDebugExtension Attribute</td>
<td>§4.7.11</td>
</tr>
<tr>
<td>LineNumberTable Attribute</td>
<td>§4.7.12</td>
</tr>
<tr>
<td>LocalVariableTable Attribute</td>
<td>§4.7.13</td>
</tr>
<tr>
<td>LocalVariableTypeTable Attribute</td>
<td>§4.7.14</td>
</tr>
<tr>
<td>Deprecated Attribute</td>
<td>§4.7.15</td>
</tr>
<tr>
<td>RuntimeVisibleAnnotations Attribute</td>
<td>§4.7.16</td>
</tr>
<tr>
<td>RuntimeInvisibleAnnotations Attribute</td>
<td>§4.7.17</td>
</tr>
<tr>
<td>RuntimeVisibleParameterAnnotations Attribute</td>
<td>§4.7.18</td>
</tr>
<tr>
<td>RuntimeInvisibleParameterAnnotations Attribute</td>
<td>§4.7.19</td>
</tr>
<tr>
<td>RuntimeVisibleTypeAnnotations Attribute</td>
<td>§4.7.20</td>
</tr>
<tr>
<td>RuntimeInvisibleTypeAnnotations Attribute</td>
<td>§4.7.21</td>
</tr>
<tr>
<td>AnnotationDefault Attribute</td>
<td>§4.7.22</td>
</tr>
<tr>
<td>BootstrapMethods Attribute</td>
<td>§4.7.23</td>
</tr>
<tr>
<td>MethodParameters Attribute</td>
<td>§4.7.24</td>
</tr>
<tr>
<td>Module Attribute</td>
<td>§4.7.25</td>
</tr>
<tr>
<td>ModulePackages Attribute</td>
<td>§4.7.26</td>
</tr>
<tr>
<td>ModuleMainClass Attribute</td>
<td>§4.7.27</td>
</tr>
<tr>
<td>NestHost Attribute</td>
<td>§4.7.28</td>
</tr>
<tr>
<td>NestMembers Attribute</td>
<td>§4.7.29</td>
</tr>
</tbody></table>
<h3 id="属性对象"><a href="#属性对象" class="headerlink" title="属性对象"></a>属性对象</h3><p>属性表是动态的，新的JDK版本可能会添加新的属性值。每一种属性的数据结构都不相同，所以读取到属性名称后还需要根据属性的类型解析不同属性表中的值。比如<code>Code Attribute</code>中存储了类方法的异常表、字节码指令集、属性信息等重要信息。</p>
<h1 id="三、Java-class文件解析"><a href="#三、Java-class文件解析" class="headerlink" title="三、Java class文件解析"></a>三、Java class文件解析</h1><p>为了能够更加深入的学习class结构，本章节将写一个<a target="_blank" rel="noopener" href="https://github.com/javaweb-sec/javaweb-sec/blob/master/javaweb-sec-source/javase/src/main/java/com/anbai/sec/bytecode/ClassByteCodeParser.java">ClassByteCodeParser类</a>（有极小部分数据结构较复杂没解析）来实现简单的class文件解析。</p>
<p>首先我们创建一个用于测试的<code>TestHelloWorld.java</code>文件，源码如下：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Creator: yz
 * Date: 2019/12/17
 */</span>
<span class="token annotation punctuation">@Deprecated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestHelloWorld</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">7366591802115333975L</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token number">1l</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"Hello:"</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> str <span class="token operator">+</span> content<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TestHelloWorld</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestHelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span>         str  <span class="token operator">=</span> test<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">"Hello World~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> username<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> password<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"TestHelloWorld{"</span> <span class="token operator">+</span>
                <span class="token string">"id="</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">", username='"</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", password='"</span> <span class="token operator">+</span> password <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token char">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后使用<code>javac</code>将<code>TestHelloWorld.java</code>编译成<code>TestHelloWorld.class</code>文件，或者使用maven构建<code>javaweb-sec/javaweb-sec-source/javase/</code>项目，构建成功后在<code>javaweb-sec/javaweb-sec-source/javase/target/classes/com/anbai/sec/bytecode/</code>目录下可以找到<code>TestHelloWorld.class</code>文件。</p>
<p>最后编写一个<code>ClassByteCodeParser类</code>，严格按照JVM规范中的类文件格式文档规定，依次解析class文件的各种数据类型就可以实现字节码解析了。</p>
<p><strong>ClassByteCodeParser代码片段（省略了getter/setter和解析逻辑）：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Java类字节码解析，参考：https://docs.oracle.com/javase/specs/jvms/se15/jvms15.pdf和https://github.com/ingokegel/jclasslib
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassByteCodeParser</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 转换为数据输入流
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">DataInputStream</span> dis<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Class文件魔数
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> magic<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Class小版本号
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> minor<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Class大版本号
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> major<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 常量池中的对象数量
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> poolCount<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 创建常量池Map
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> constantPoolMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 类访问修饰符
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> accessFlags<span class="token punctuation">;</span>

    <span class="token comment">/**
     * thisClass
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> thisClass<span class="token punctuation">;</span>

    <span class="token comment">/**
     * superClass
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> superClass<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 接口数
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> interfacesCount<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 接口Index数组
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 成员变量数量
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> fieldsCount<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 成员变量数组
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> fieldList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 方法数
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> methodsCount<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 方法数组
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> methodList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 属性数
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> attributesCount<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 属性
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> attributes<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 解析Class字节码
     *
     * @param in 类字节码输入流
     * @throws IOException 解析IO异常
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">parseByteCode</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将输入流转换成DataInputStream</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 解析字节码逻辑代码</span>
  <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 解析单个class文件</span>
        <span class="token class-name">File</span>                classFile  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"javaweb-sec-source/javase/target/classes/com/anbai/sec/bytecode/TestHelloWorld.class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClassByteCodeParser</span> codeParser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassByteCodeParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        codeParser<span class="token punctuation">.</span><span class="token function">parseByteCode</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>classFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>codeParser<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解析完<code>TestHelloWorld.class</code>后将会生成一个json字符串，省略掉复杂的<code>constantPoolMap</code>、<code>fieldList</code>、<code>methodList</code>、<code>attributes</code>属性后格式如下：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"accessFlags"</span><span class="token operator">:</span> <span class="token number">33</span><span class="token punctuation">,</span> 
    <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token property">"attributesCount"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> 
    <span class="token property">"constantPoolMap"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token property">"fieldList"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token property">"fieldsCount"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> 
    <span class="token property">"interfaces"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"java/io/Serializable"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token property">"interfacesCount"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
    <span class="token property">"magic"</span><span class="token operator">:</span> <span class="token number">-889275714</span><span class="token punctuation">,</span> 
    <span class="token property">"major"</span><span class="token operator">:</span> <span class="token number">51</span><span class="token punctuation">,</span> 
    <span class="token property">"methodList"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token property">"methodsCount"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> 
    <span class="token property">"minor"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
    <span class="token property">"poolCount"</span><span class="token operator">:</span> <span class="token number">95</span><span class="token punctuation">,</span> 
    <span class="token property">"superClass"</span><span class="token operator">:</span> <span class="token string">"java/lang/Object"</span><span class="token punctuation">,</span> 
    <span class="token property">"thisClass"</span><span class="token operator">:</span> <span class="token string">"com/anbai/sec/bytecode/TestHelloWorld"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-1-魔数-版本解析"><a href="#3-1-魔数-版本解析" class="headerlink" title="3.1 魔数/版本解析"></a>3.1 魔数/版本解析</h2><p>一个合法的class文件以固定的<code>0xCAFEBABE</code>格式开始，所以需要先读取4个字节，判断文件二进制格式是否是合法。</p>
<pre class="line-numbers language-none"><code class="language-none">u4 magic;
u2 minor_version;
u2 major_version;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>魔数和版本号解析代码片段：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// u4 magic;</span>
<span class="token keyword">int</span> magic <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 校验文件魔数</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0xCAFEBABE</span> <span class="token operator">==</span> magic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>magic <span class="token operator">=</span> magic<span class="token punctuation">;</span>

   <span class="token comment">// u2 minor_version</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>minor <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// u2 major_version;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>major <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解析结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"magic"</span><span class="token operator">:</span> <span class="token number">-889275714</span><span class="token punctuation">,</span> 
    <span class="token property">"minor"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
    <span class="token property">"major"</span><span class="token operator">:</span> <span class="token number">51</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中<code>"major": 51</code>对应的JDK版本是JDK1.7。</p>
<h2 id="3-2-常量池解析"><a href="#3-2-常量池解析" class="headerlink" title="3.2 常量池解析"></a>3.2 常量池解析</h2><p>解析常量池信息时需要先解析出常量池对象的数量，然后遍历常量池，解析<code>cp_info</code>对象。</p>
<pre class="line-numbers language-none"><code class="language-none">u2 constant_pool_count;
cp_info constant_pool[constant_pool_count-1];<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>为了便于理解解析过程，特意将常量池解析流程单独拆开成如下几步：</p>
<ol>
<li>读取常量池数量（<code>u2 constant_pool_count;</code>）；</li>
<li>读取<code>tag</code>；</li>
<li>根据不同的<code>tag</code>类型解析常量池对象；</li>
<li>解析常量池中的对象；</li>
<li>链接常量池中的索引引用；</li>
</ol>
<p><strong>常量池解析片段：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 解析常量池数据
 *
 * @throws IOException 数据读取异常
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">parseConstantPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// u2 constant_pool_count;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>poolCount <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// cp_info constant_pool[constant_pool_count-1];</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> poolCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//            cp_info {</span>
        <span class="token comment">//                u1 tag;</span>
        <span class="token comment">//                u1 info[];</span>
        <span class="token comment">//            }</span>
        <span class="token keyword">int</span>      tag      <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Constant</span> constant <span class="token operator">=</span> <span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token function">getConstant</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>constant <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"解析常量池异常，无法识别的常量池类型："</span> <span class="token operator">+</span> tag<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 解析常量池对象</span>
        <span class="token function">parseConstantItems</span><span class="token punctuation">(</span>constant<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Long和Double是宽类型，占两位</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CONSTANT_LONG</span> <span class="token operator">==</span> constant <span class="token operator">||</span> <span class="token constant">CONSTANT_DOUBLE</span> <span class="token operator">==</span> constant<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 链接常量池中的引用</span>
    <span class="token function">linkConstantPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>解析常量池对象代码片段：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
     * 解析常量池中的对象
     *
     * @param constant 常量池
     * @param index    常量池中的索引位置
     * @throws IOException 数据读取异常
     */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">parseConstantItems</span><span class="token punctuation">(</span><span class="token class-name">Constant</span> constant<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>constant<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_UTF8</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Utf8_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 length;</span>
          <span class="token comment">//                        u1 bytes[length];</span>
          <span class="token comment">//                    }</span>

          <span class="token keyword">int</span> length <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
          dis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_UTF8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_INTEGER</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Integer_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u4 bytes;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_FLOAT</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Float_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u4 bytes;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_FLOAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_LONG</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Long_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u4 high_bytes;</span>
          <span class="token comment">//                        u4 low_bytes;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_LONG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_DOUBLE</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Double_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u4 high_bytes;</span>
          <span class="token comment">//                        u4 low_bytes;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_DOUBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_CLASS</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Class_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 name_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nameIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_STRING</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_String_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 string_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_STRING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"stringIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_FIELD_REF</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Fieldref_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 class_index;</span>
          <span class="token comment">//                        u2 name_and_type_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_FIELD_REF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"classIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nameAndTypeIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_METHOD_REF</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Methodref_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 class_index;</span>
          <span class="token comment">//                        u2 name_and_type_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_METHOD_REF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"classIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nameAndTypeIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_INTERFACE_METHOD_REF</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_InterfaceMethodref_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 class_index;</span>
          <span class="token comment">//                        u2 name_and_type_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_INTERFACE_METHOD_REF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"classIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nameAndTypeIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_NAME_AND_TYPE</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_NameAndType_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 name_index;</span>
          <span class="token comment">//                        u2 descriptor_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_NAME_AND_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nameIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"descriptorIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_METHOD_HANDLE</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_MethodHandle_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u1 reference_kind;</span>
          <span class="token comment">//                        u2 reference_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_METHOD_HANDLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"referenceKind"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"referenceIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_METHOD_TYPE</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_MethodType_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 descriptor_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_METHOD_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"descriptorIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_DYNAMIC</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Dynamic_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 bootstrap_method_attr_index;</span>
          <span class="token comment">//                        u2 name_and_type_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_DYNAMIC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrapMethodAttrIdx"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nameAndTypeIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_INVOKE_DYNAMIC</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_InvokeDynamic_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 bootstrap_method_attr_index;</span>
          <span class="token comment">//                        u2 name_and_type_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_INVOKE_DYNAMIC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrapMethodAttrIdx"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nameAndTypeIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_MODULE</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Module_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 name_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_MODULE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nameIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSTANT_PACKAGE</span><span class="token operator">:</span>
          <span class="token comment">//                    CONSTANT_Package_info {</span>
          <span class="token comment">//                        u1 tag;</span>
          <span class="token comment">//                        u2 name_index;</span>
          <span class="token comment">//                    }</span>

          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">,</span> <span class="token constant">CONSTANT_PACKAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nameIndex"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    constantPoolMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解析完常量池的对象后会发现很多数据结构中都引用了其他对象，比如ID（索引位置）为1的常量池对象<code>CONSTANT_METHOD_REF</code>引用了ID为21的<code>CONSTANT_CLASS</code>对象和ID为64的<code>CONSTANT_NAME_AND_TYPE</code>对象，而<code>CONSTANT_CLASS</code>对象又引用了<code>CONSTANT_UTF8</code>（<code>java/lang/Object</code>）、<code>CONSTANT_NAME_AND_TYPE</code>同时引用了<code>CONSTANT_UTF8</code>（<code>&lt;init&gt;</code>）和<code>CONSTANT_UTF8</code>（<code>()V</code>）,为了能够直观的看到常量池ID为1的对象信息我们就必须要将所有使用索引方式链接的映射关系改成直接字符串引用，最终得到如下结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"constantPoolMap"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"1"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"tag"</span><span class="token operator">:</span> <span class="token string">"CONSTANT_METHOD_REF"</span><span class="token punctuation">,</span> 
            <span class="token property">"classIndex"</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span> 
            <span class="token property">"nameAndTypeIndex"</span><span class="token operator">:</span> <span class="token number">64</span><span class="token punctuation">,</span> 
            <span class="token property">"classValue"</span><span class="token operator">:</span> <span class="token string">"java/lang/Object"</span><span class="token punctuation">,</span> 
            <span class="token property">"nameAndTypeValue"</span><span class="token operator">:</span> <span class="token string">"&lt;init&gt;"</span>
        <span class="token punctuation">}</span>
             .... 省略其他对象
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常量池对象链接代码片段：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 链接常量池中的引用
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">linkConstantPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> id <span class="token operator">:</span> constantPoolMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> valueMap <span class="token operator">=</span> constantPoolMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valueMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> newMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> valueMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"Index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token class-name">Object</span> value <span class="token operator">=</span> <span class="token function">recursionValue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> valueMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">String</span> newKey <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"Index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        newMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newKey <span class="token operator">+</span> <span class="token string">"Value"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            valueMap<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>newMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 递归查找ID对应的常量池中的值
 *
 * @param id 常量池ID
 * @return 常量池中存储的值
 */</span>
<span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">recursionValue</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> constantPoolMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"Index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Integer</span> value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token function">recursionValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>为了方便通过ID（常量池索引）访问常量池中的对象值，封装了一个<code>getConstantPoolValue</code>方法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 通过常量池中的索引ID和名称获取常量池中的值
 *
 * @param index 索引ID
 * @return 常量池对象值
 */</span>
<span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">getConstantPoolValue</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>constantPoolMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataMap  <span class="token operator">=</span> constantPoolMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Constant</span>            constant <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">)</span> dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>constant<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_UTF8</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_INTEGER</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_FLOAT</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_LONG</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_DOUBLE</span><span class="token operator">:</span>
              <span class="token keyword">return</span> dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_CLASS</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_MODULE</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_PACKAGE</span><span class="token operator">:</span>
              <span class="token keyword">return</span> dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"nameValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_STRING</span><span class="token operator">:</span>
              <span class="token keyword">return</span> dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"stringValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_FIELD_REF</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_METHOD_REF</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_INTERFACE_METHOD_REF</span><span class="token operator">:</span>
              <span class="token keyword">return</span> dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"classValue"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"nameAndTypeValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_NAME_AND_TYPE</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_METHOD_TYPE</span><span class="token operator">:</span>
              <span class="token keyword">return</span> dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"descriptorValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_METHOD_HANDLE</span><span class="token operator">:</span>
              <span class="token keyword">return</span> dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"referenceValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_DYNAMIC</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token constant">CONSTANT_INVOKE_DYNAMIC</span><span class="token operator">:</span>
              <span class="token keyword">return</span> dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"bootstrapMethodAttrValue"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"nameAndTypeValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">default</span><span class="token operator">:</span>
              <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>

     <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-3-访问标志解析"><a href="#3-3-访问标志解析" class="headerlink" title="3.3 访问标志解析"></a>3.3 访问标志解析</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// u2 access_flags;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>accessFlags <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>解析结果：<code>"accessFlags": 33,</code>。</p>
<h2 id="3-4-当前类名称解析"><a href="#3-4-当前类名称解析" class="headerlink" title="3.4 当前类名称解析"></a>3.4 当前类名称解析</h2><p>解析类名称的时候直接读取2个无符号数，获取到类名所在的常量池中的索引位置，然后根据常量池ID读取常量池中的字符串内容即可解析出类名。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// u2 this_class;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>thisClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token function">getConstantPoolValue</span><span class="token punctuation">(</span>dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>解析结果：<code>"thisClass": "com/anbai/sec/bytecode/TestHelloWorld"</code>。</p>
<h2 id="3-5-当前类的父类名称解析"><a href="#3-5-当前类的父类名称解析" class="headerlink" title="3.5 当前类的父类名称解析"></a>3.5 当前类的父类名称解析</h2><p>解析<code>super_class</code>的时候也是需要特别注意，当解析<code>java.lang.Object</code>时<code>super_class</code>的值为0，常量池中不包含索引为0的对象，所以需要直接将父类名称设置为<code>java/lang/Object</code>。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// u2 super_class;</span>
<span class="token keyword">int</span> superClassIndex <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 当解析Object类的时候super_class为0</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>superClassIndex <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>superClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token function">getConstantPoolValue</span><span class="token punctuation">(</span>superClassIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>superClass <span class="token operator">=</span> <span class="token string">"java/lang/Object"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解析结果：<code>"superClass": "java/lang/Object",</code>。</p>
<h2 id="3-6-接口解析"><a href="#3-6-接口解析" class="headerlink" title="3.6 接口解析"></a>3.6 接口解析</h2><p>解析接口信息时需要先解析出接口的数量，然后就可以遍历出所有的接口名称索引值了。</p>
<pre class="line-numbers language-none"><code class="language-none">u2 interfaces_count;
u2 interfaces[interfaces_count];<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>接口解析代码片段：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// u2 interfaces_count;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>interfacesCount <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建接口Index数组</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>interfaces <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>interfacesCount<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// u2 interfaces[interfaces_count];</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> interfacesCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> index <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置接口名称</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>interfaces<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token function">getConstantPoolValue</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解析结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"interfacesCount"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
    <span class="token property">"interfaces"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"java/io/Serializable"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-7-成员变量-成员方法解析"><a href="#3-7-成员变量-成员方法解析" class="headerlink" title="3.7 成员变量/成员方法解析"></a>3.7 成员变量/成员方法解析</h2><p>成员变量和成员方法的数据结构是一样的，所以可以使用相同的解析逻辑。首先解析出变量/方法的总数量，然后遍历并解析<code>field_info</code>或<code>method_info</code>对象的所有信息。</p>
<p><strong>成员变量/成员方法解析代码片段：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// u2 fields_count;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>fieldsCount <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// field_info fields[fields_count];</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fieldsCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//                field_info {</span>
    <span class="token comment">//                    u2 access_flags;</span>
    <span class="token comment">//                    u2 name_index;</span>
    <span class="token comment">//                    u2 descriptor_index;</span>
    <span class="token comment">//                    u2 attributes_count;</span>
    <span class="token comment">//                    attribute_info attributes[attributes_count];</span>
    <span class="token comment">//                }</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>fieldList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">readFieldOrMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 读取成员变量或者方法的公用属性
 *
 * @return 成员变量或方法属性信息
 * @throws IOException 读取异常
 */</span>
<span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">readFieldOrMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// u2 access_flags;</span>
    dataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"access"</span><span class="token punctuation">,</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// u2 name_index;</span>
    dataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token function">getConstantPoolValue</span><span class="token punctuation">(</span>dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// u2 descriptor_index;</span>
    dataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"desc"</span><span class="token punctuation">,</span> <span class="token function">getConstantPoolValue</span><span class="token punctuation">(</span>dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// u2 attributes_count;</span>
    <span class="token keyword">int</span> attributesCount <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"attributesCount"</span><span class="token punctuation">,</span> attributesCount<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 读取成员变量属性信息</span>
    dataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"attributes"</span><span class="token punctuation">,</span> <span class="token function">readAttributes</span><span class="token punctuation">(</span>attributesCount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> dataMap<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>成员变量解析结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"fieldsCount"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> 
    <span class="token property">"fieldList"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"access"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"password"</span><span class="token punctuation">,</span> 
            <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"Ljava/lang/String;"</span><span class="token punctuation">,</span> 
            <span class="token property">"attributesCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
            <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token punctuation">{</span>
            <span class="token property">"access"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> 
            <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"J"</span><span class="token punctuation">,</span> 
            <span class="token property">"attributesCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
            <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token punctuation">{</span>
            <span class="token property">"access"</span><span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span> 
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"serialVersionUID"</span><span class="token punctuation">,</span> 
            <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"J"</span><span class="token punctuation">,</span> 
            <span class="token property">"attributesCount"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
            <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"attributeName"</span><span class="token operator">:</span> <span class="token string">"ConstantValue"</span><span class="token punctuation">,</span> 
                <span class="token property">"attributeLength"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
                <span class="token property">"ConstantValue"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">"constantValue"</span><span class="token operator">:</span> <span class="token number">-7366591802115334000</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token punctuation">{</span>
            <span class="token property">"access"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"username"</span><span class="token punctuation">,</span> 
            <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"Ljava/lang/String;"</span><span class="token punctuation">,</span> 
            <span class="token property">"attributesCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
            <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>成员方法解析结果（因结果过大，仅保留了一个<code>getPassword</code>方法）：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"methodsCount"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> 
    <span class="token property">"methodList"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"access"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"getPassword"</span><span class="token punctuation">,</span> 
            <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"()Ljava/lang/String;"</span><span class="token punctuation">,</span> 
            <span class="token property">"attributesCount"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
            <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"attributeName"</span><span class="token operator">:</span> <span class="token string">"Code"</span><span class="token punctuation">,</span> 
                <span class="token property">"attributeLength"</span><span class="token operator">:</span> <span class="token number">47</span><span class="token punctuation">,</span> 
                <span class="token property">"Code"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">"maxStack"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
                    <span class="token property">"maxLocals"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
                    <span class="token property">"codeLength"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> 
                    <span class="token property">"opcodes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">"aload_0"</span><span class="token punctuation">,</span> 
                        <span class="token string">"getfield #15 &lt;com/anbai/sec/bytecode/TestHelloWorld.password&gt;"</span><span class="token punctuation">,</span> 
                        <span class="token string">"areturn"</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    <span class="token property">"exceptionTable"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">"exceptionTableLength"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
                        <span class="token property">"exceptionTableList"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
                    <span class="token property">"attributeLength"</span><span class="token operator">:</span> <span class="token number">47</span><span class="token punctuation">,</span> 
                    <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">"attributeName"</span><span class="token operator">:</span> <span class="token string">"LocalVariableTable"</span><span class="token punctuation">,</span> 
                        <span class="token property">"attributeLength"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> 
                        <span class="token property">"LineNumberTable"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">"lineNumberTableLength"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
                            <span class="token property">"lineNumberTableList"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                <span class="token punctuation">{</span>
                                    <span class="token property">"startPc"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
                                    <span class="token property">"lineNumber"</span><span class="token operator">:</span> <span class="token number">49</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">]</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
                        <span class="token property">"LocalVariableTable"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">"localVariableTableLength"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
                            <span class="token property">"localVariableTableList"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                <span class="token punctuation">{</span>
                                    <span class="token property">"startPc"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
                                    <span class="token property">"length"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> 
                                    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"this"</span><span class="token punctuation">,</span> 
                                    <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"Lcom/anbai/sec/bytecode/TestHelloWorld;"</span><span class="token punctuation">,</span> 
                                    <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">]</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-8-属性解析"><a href="#3-8-属性解析" class="headerlink" title="3.8 属性解析"></a>3.8 属性解析</h2><p>成员变量、成员方法、类对象这三种数据结构都需要解析属性信息，因为逻辑非常复杂，将在下一小节详解。</p>
<h1 id="四、Java-class文件属性解析"><a href="#四、Java-class文件属性解析" class="headerlink" title="四、Java class文件属性解析"></a>四、Java class文件属性解析</h1><p>class文件的属性解析是非常复杂的，因为属性表由非常多的类型组成，几乎每一个数据类型都不一样，而且属性表是动态的，它还会随着JDK的版本升级而新增属性对象。在class文件中：<code>成员变量</code>、<code>成员方法</code>、<code>类</code>都拥有属性信息，解析的时候可以使用同样的方法。因为属性表中的属性类型过多，本节仅以解析<code>ConstantValue</code>、<code>Code</code>为例，完整的解析代码请参考<a target="_blank" rel="noopener" href="https://github.com/javaweb-sec/javaweb-sec/blob/master/javaweb-sec-source/javase/src/main/java/com/anbai/sec/bytecode/ClassByteCodeParser.java#L570">ClassByteCodeParser类</a>。</p>
<p><strong>属性信息表数据结构：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">u2 attributes_count;
attribute_info attributes[attributes_count];

attribute_info {
   u2 attribute_name_index;
   u4 attribute_length;
   u1 info[attribute_length];
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>u2 attributes_count;</code>表示的是属性表的长度，循环所有属性对象可得到<code>attribute_info</code>对象。<code>attribute_info</code>对象有两个固定的属性值：<code>u2 attribute_name_index;</code>（属性名称）和<code>u4 attribute_length;</code>（属性的字节长度），我们可以先解析出这两个属性：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// u2 attribute_name_index;</span>
<span class="token class-name">String</span> attributeName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token function">getConstantPoolValue</span><span class="token punctuation">(</span>dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// u4 attribute_length;</span>
<span class="token keyword">int</span> attributeLength <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解析出属性名称后就需要参考<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7">JVM虚拟机规范第4.7章-属性</a>来解析各类属性信息了。</p>
<p><strong>预定义属性表</strong></p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>属性位置</th>
<th>章节</th>
<th>Java版本</th>
</tr>
</thead>
<tbody><tr>
<td><code>ConstantValue</code></td>
<td><code>field_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.2">§4.7.2</a></td>
<td>1.0.2</td>
</tr>
<tr>
<td><code>Code</code></td>
<td><code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.3">§4.7.3</a></td>
<td>1.0.2</td>
</tr>
<tr>
<td><code>StackMapTable</code></td>
<td><code>Code</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.4">§4.7.4</a></td>
<td>6</td>
</tr>
<tr>
<td><code>Exceptions</code></td>
<td><code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.5">§4.7.5</a></td>
<td>1.0.2</td>
</tr>
<tr>
<td><code>InnerClasses</code></td>
<td><code>ClassFile</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.6">§4.7.6</a></td>
<td>1.1</td>
</tr>
<tr>
<td><code>EnclosingMethod</code></td>
<td><code>ClassFile</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.7">§4.7.7</a></td>
<td>5.0</td>
</tr>
<tr>
<td><code>Synthetic</code></td>
<td><code>ClassFile</code>, <code>field_info</code>, <code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.8">§4.7.8</a></td>
<td>1.1</td>
</tr>
<tr>
<td><code>Signature</code></td>
<td><code>ClassFile</code>, <code>field_info</code>, <code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.9">§4.7.9</a></td>
<td>5.0</td>
</tr>
<tr>
<td><code>SourceFile</code></td>
<td><code>ClassFile</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.10">§4.7.10</a></td>
<td>1.0.2</td>
</tr>
<tr>
<td><code>SourceDebugExtension</code></td>
<td><code>ClassFile</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.11">§4.7.11</a></td>
<td>5.0</td>
</tr>
<tr>
<td><code>LineNumberTable</code></td>
<td><code>Code</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.12">§4.7.12</a></td>
<td>1.0.2</td>
</tr>
<tr>
<td><code>LocalVariableTable</code></td>
<td><code>Code</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.13">§4.7.13</a></td>
<td>1.0.2</td>
</tr>
<tr>
<td><code>LocalVariableTypeTable</code></td>
<td><code>Code</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.14">§4.7.14</a></td>
<td>5.0</td>
</tr>
<tr>
<td><code>Deprecated</code></td>
<td><code>ClassFile</code>, <code>field_info</code>, <code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.15">§4.7.15</a></td>
<td>1.1</td>
</tr>
<tr>
<td><code>RuntimeVisibleAnnotations</code></td>
<td><code>ClassFile</code>, <code>field_info</code>, <code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.16">§4.7.16</a></td>
<td>5.0</td>
</tr>
<tr>
<td><code>RuntimeInvisibleAnnotations</code></td>
<td><code>ClassFile</code>, <code>field_info</code>, <code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.17">§4.7.17</a></td>
<td>5.0</td>
</tr>
<tr>
<td><code>RuntimeVisibleParameterAnnotations</code></td>
<td><code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.18">§4.7.18</a></td>
<td>5.0</td>
</tr>
<tr>
<td><code>RuntimeInvisibleParameterAnnotations</code></td>
<td><code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.19">§4.7.19</a></td>
<td>5.0</td>
</tr>
<tr>
<td><code>RuntimeVisibleTypeAnnotations</code></td>
<td><code>ClassFile</code>, <code>field_info</code>, <code>method_info</code>, <code>Code</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.20">§4.7.20</a></td>
<td>8</td>
</tr>
<tr>
<td><code>RuntimeInvisibleTypeAnnotations</code></td>
<td><code>ClassFile</code>, <code>field_info</code>, <code>method_info</code>, <code>Code</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.21">§4.7.21</a></td>
<td>8</td>
</tr>
<tr>
<td><code>AnnotationDefault</code></td>
<td><code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.22">§4.7.22</a></td>
<td>5.0</td>
</tr>
<tr>
<td><code>BootstrapMethods</code></td>
<td><code>ClassFile</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.23">§4.7.23</a></td>
<td>7</td>
</tr>
<tr>
<td><code>MethodParameters</code></td>
<td><code>method_info</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.24">§4.7.24</a></td>
<td>8</td>
</tr>
<tr>
<td><code>Module</code></td>
<td><code>ClassFile</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.25">§4.7.25</a></td>
<td>9</td>
</tr>
<tr>
<td><code>ModulePackages</code></td>
<td><code>ClassFile</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.26">§4.7.26</a></td>
<td>9</td>
</tr>
<tr>
<td><code>ModuleMainClass</code></td>
<td><code>ClassFile</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.27">§4.7.27</a></td>
<td>9</td>
</tr>
<tr>
<td><code>NestHost</code></td>
<td><code>ClassFile</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.28">§4.7.28</a></td>
<td>11</td>
</tr>
<tr>
<td><code>NestMembers</code></td>
<td><code>ClassFile</code></td>
<td><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.29">§4.7.29</a></td>
<td>11</td>
</tr>
</tbody></table>
<h2 id="4-1-ConstantValue"><a href="#4-1-ConstantValue" class="headerlink" title="4.1 ConstantValue"></a>4.1 ConstantValue</h2><p><code>ConstantValue</code>属性用于表示<code>field_info</code>中的静态变量的初始值，结构如下：</p>
<pre class="line-numbers language-none"><code class="language-none">ConstantValue_attribute {
    u2 attribute_name_index;
    u4 attribute_length;
    u2 constantvalue_index;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ConstantValue解析代码片段：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 创建属性Map</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> attrMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// u2 constantvalue_index;</span>
attrMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"constantValue"</span><span class="token punctuation">,</span> <span class="token function">getConstantPoolValue</span><span class="token punctuation">(</span>dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

attributeMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ConstantValue"</span><span class="token punctuation">,</span> attrMap<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解析后的结果如下：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"access"</span><span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span> 
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"serialVersionUID"</span><span class="token punctuation">,</span> 
  <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"J"</span><span class="token punctuation">,</span> 
  <span class="token property">"attributesCount"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
  <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"attributeName"</span><span class="token operator">:</span> <span class="token string">"ConstantValue"</span><span class="token punctuation">,</span> 
    <span class="token property">"attributeLength"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
    <span class="token property">"ConstantValue"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"constantValue"</span><span class="token operator">:</span> <span class="token number">-7366591802115334000</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-2-Code"><a href="#4-2-Code" class="headerlink" title="4.2 Code"></a>4.2 Code</h2><p><code>Code</code>属性用于表示成员方法的代码部分，<code>Code</code>中包含了指令集（<code>byte数组</code>），JVM调用成员方法时实际上就是执行的<code>Code</code>中的指令，而反编译工具则是把<code>Code</code>中的指令翻译成了Java代码。</p>
<pre class="line-numbers language-none"><code class="language-none">Code_attribute {
  u2 attribute_name_index;
  u4 attribute_length;
  u2 max_stack;
  u2 max_locals;
  u4 code_length;
  u1 code[code_length];
  u2 exception_table_length;
  { u2 start_pc;
   u2 end_pc;
   u2 handler_pc;
   u2 catch_type;
  } exception_table[exception_table_length];
  u2 attributes_count;
  attribute_info attributes[attributes_count];
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Code解析代码片段：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span>          maxStack   <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>          maxLocals  <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>          codeLength <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> opcodeList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span>       bytes      <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>codeLength<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 读取所有的code字节</span>
dis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建Code输入流</span>
<span class="token class-name">DataInputStream</span> bis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建属性Map</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> attrMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
attrMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"maxStack"</span><span class="token punctuation">,</span> maxStack<span class="token punctuation">)</span><span class="token punctuation">;</span>
attrMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"maxLocals"</span><span class="token punctuation">,</span> maxLocals<span class="token punctuation">)</span><span class="token punctuation">;</span>
attrMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"codeLength"</span><span class="token punctuation">,</span> codeLength<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 是否是宽类型</span>
<span class="token keyword">boolean</span> wide <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> offset <span class="token operator">&lt;</span> codeLength<span class="token punctuation">;</span> offset<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span>     branchOffset          <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     defaultOffset         <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     switchNumberofPairs   <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     switchNumberOfOffsets <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     immediateByte         <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     immediateShort        <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     arrayDimensions       <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     incrementConst        <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     incrementConst2       <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     switchMatch           <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     switchOffset          <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span>   switchJumpOffsets     <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     bytesToRead           <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     code                  <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Opcodes</span> opcode                <span class="token operator">=</span> <span class="token class-name">Opcodes</span><span class="token punctuation">.</span><span class="token function">getOpcodes</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>opcode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>opcode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token constant">BIPUSH</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">LDC</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">ILOAD</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">LLOAD</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">FLOAD</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">DLOAD</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">ALOAD</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">ISTORE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">LSTORE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">FSTORE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">DSTORE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">ASTORE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">RET</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">NEWARRAY</span><span class="token operator">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>wide<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            immediateByte <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            immediateByte <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token function">addOpcodes</span><span class="token punctuation">(</span>opcodeList<span class="token punctuation">,</span> opcode<span class="token punctuation">,</span> immediateByte<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// 因为读取了byte，所以需要重新计算bis偏移量</span>
          offset <span class="token operator">+=</span> wide <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">LDC_W</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">LDC2_W</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">GETSTATIC</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">PUTSTATIC</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">GETFIELD</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">PUTFIELD</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">INVOKEVIRTUAL</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">INVOKESPECIAL</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">INVOKESTATIC</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">NEW</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">ANEWARRAY</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">CHECKCAST</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">INSTANCEOF</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">SIPUSH</span><span class="token operator">:</span>
          <span class="token function">addOpcodes</span><span class="token punctuation">(</span>opcodeList<span class="token punctuation">,</span> opcode<span class="token punctuation">,</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          offset <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">IFEQ</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IFNE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IFLT</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IFGE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IFGT</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IFLE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IF_ICMPEQ</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IF_ICMPNE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IF_ICMPLT</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IF_ICMPGE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IF_ICMPGT</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IF_ICMPLE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IF_ACMPEQ</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IF_ACMPNE</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">GOTO</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">JSR</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IFNULL</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">IFNONNULL</span><span class="token operator">:</span>
          branchOffset <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          opcodeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>opcode<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> branchOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

          offset <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">GOTO_W</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">JSR_W</span><span class="token operator">:</span>
          branchOffset <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          opcodeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>opcode<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> branchOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

          offset <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">IINC</span><span class="token operator">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>wide<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            incrementConst <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            incrementConst <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>wide<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            incrementConst2 <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            incrementConst2 <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          opcodeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>opcode<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> incrementConst <span class="token operator">+</span> <span class="token string">" by "</span> <span class="token operator">+</span> incrementConst2<span class="token punctuation">)</span><span class="token punctuation">;</span>

          offset <span class="token operator">+=</span> wide <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">TABLESWITCH</span><span class="token operator">:</span>
          bytesToRead <span class="token operator">=</span> <span class="token function">readPaddingBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> bis<span class="token punctuation">)</span><span class="token punctuation">;</span>

          defaultOffset <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">int</span> lowByte <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">int</span> highByte <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          switchNumberOfOffsets <span class="token operator">=</span> highByte <span class="token operator">-</span> lowByte <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
          switchJumpOffsets <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>switchNumberOfOffsets<span class="token punctuation">]</span><span class="token punctuation">;</span>

          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> switchNumberOfOffsets<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            switchJumpOffsets<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          opcodeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>opcode<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          offset <span class="token operator">+=</span> bytesToRead <span class="token operator">+</span> <span class="token number">12</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> switchNumberOfOffsets<span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">LOOKUPSWITCH</span><span class="token operator">:</span>
          bytesToRead <span class="token operator">=</span> <span class="token function">readPaddingBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> bis<span class="token punctuation">)</span><span class="token punctuation">;</span>

          defaultOffset <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          switchNumberofPairs <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> switchNumberofPairs<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            switchMatch <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            switchOffset <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          opcodeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>opcode<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          offset <span class="token operator">+=</span> bytesToRead <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">*</span> switchNumberofPairs<span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">INVOKEINTERFACE</span><span class="token operator">:</span>
          immediateShort <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          offset <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>

          <span class="token keyword">int</span> count <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// 下1个byte永远为0，所以直接丢弃</span>
          bis<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token function">addOpcodes</span><span class="token punctuation">(</span>opcodeList<span class="token punctuation">,</span> opcode<span class="token punctuation">,</span> immediateShort<span class="token punctuation">)</span><span class="token punctuation">;</span>

          offset <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">INVOKEDYNAMIC</span><span class="token operator">:</span>
          immediateShort <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          offset <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>

          <span class="token comment">// 下2个byte永远为0，所以直接丢弃</span>
          bis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token function">addOpcodes</span><span class="token punctuation">(</span>opcodeList<span class="token punctuation">,</span> opcode<span class="token punctuation">,</span> immediateShort<span class="token punctuation">)</span><span class="token punctuation">;</span>

          offset <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">MULTIANEWARRAY</span><span class="token operator">:</span>
          immediateShort <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          offset <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>

          arrayDimensions <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">readUnsignedByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token function">addOpcodes</span><span class="token punctuation">(</span>opcodeList<span class="token punctuation">,</span> opcode<span class="token punctuation">,</span> immediateShort<span class="token punctuation">)</span><span class="token punctuation">;</span>

          offset <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
          opcodeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>opcode<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    wide <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">WIDE</span> <span class="token operator">==</span> opcode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

attrMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"opcodes"</span><span class="token punctuation">,</span> opcodeList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取异常表</span>
attrMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"exceptionTable"</span><span class="token punctuation">,</span> <span class="token function">readExceptionTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// u2 attributes_count;</span>
<span class="token keyword">int</span> attributesCount <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
attrMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"attributeLength"</span><span class="token punctuation">,</span> attributeLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
attrMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"attributes"</span><span class="token punctuation">,</span> <span class="token function">readAttributes</span><span class="token punctuation">(</span>attributesCount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 递归读取属性信息</span>
attributeMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Code"</span><span class="token punctuation">,</span> attrMap<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在解析<code>Code</code>属性时<code>code_length</code>表示的是<code>Code</code>的字节长度，<code>max_stack</code>和<code>max_locals</code>是一个固定值，表示的是最大操作数栈和最大局部变量数，这两个值是在编译类方法时自动计算出来的，如果通过<code>ASM</code>修改了类方法可能会需要重新计算<code>max_stack</code>和<code>max_locals</code>。</p>
<p><strong>示例 - TestHelloWorld类Hello方法解析结果：</strong></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"access"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> 
  <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"(Ljava/lang/String;)Ljava/lang/String;"</span><span class="token punctuation">,</span> 
  <span class="token property">"attributesCount"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
  <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"attributeName"</span><span class="token operator">:</span> <span class="token string">"Code"</span><span class="token punctuation">,</span> 
    <span class="token property">"attributeLength"</span><span class="token operator">:</span> <span class="token number">88</span><span class="token punctuation">,</span> 
    <span class="token property">"Code"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"maxStack"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
      <span class="token property">"maxLocals"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> 
      <span class="token property">"codeLength"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> 
      <span class="token property">"opcodes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"ldc #3 &lt;Hello:&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"astore_2"</span><span class="token punctuation">,</span> 
        <span class="token string">"new #4 &lt;java/lang/StringBuilder&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"dup"</span><span class="token punctuation">,</span> 
        <span class="token string">"invokespecial #5 &lt;java/lang/StringBuilder.&lt;init&gt;&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"aload_2"</span><span class="token punctuation">,</span> 
        <span class="token string">"invokevirtual #6 &lt;java/lang/StringBuilder.append&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"aload_1"</span><span class="token punctuation">,</span> 
        <span class="token string">"invokevirtual #6 &lt;java/lang/StringBuilder.append&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"invokevirtual #7 &lt;java/lang/StringBuilder.toString&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"areturn"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span> 
      <span class="token property">"exceptionTable"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"exceptionTableLength"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
        <span class="token property">"exceptionTableList"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> 
      <span class="token property">"attributeLength"</span><span class="token operator">:</span> <span class="token number">88</span><span class="token punctuation">,</span> 
      <span class="token property">"attributes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"attributeName"</span><span class="token operator">:</span> <span class="token string">"LocalVariableTable"</span><span class="token punctuation">,</span> 
        <span class="token property">"attributeLength"</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span> 
        <span class="token property">"LineNumberTable"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"lineNumberTableLength"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
          <span class="token property">"lineNumberTableList"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token property">"startPc"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
              <span class="token property">"lineNumber"</span><span class="token operator">:</span> <span class="token number">21</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> 
            <span class="token punctuation">{</span>
              <span class="token property">"startPc"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> 
              <span class="token property">"lineNumber"</span><span class="token operator">:</span> <span class="token number">22</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">"LocalVariableTable"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"localVariableTableLength"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> 
          <span class="token property">"localVariableTableList"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token property">"startPc"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
              <span class="token property">"length"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> 
              <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"this"</span><span class="token punctuation">,</span> 
              <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"Lcom/anbai/sec/bytecode/TestHelloWorld;"</span><span class="token punctuation">,</span> 
              <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> 
            <span class="token punctuation">{</span>
              <span class="token property">"startPc"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
              <span class="token property">"length"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> 
              <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"content"</span><span class="token punctuation">,</span> 
              <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"Ljava/lang/String;"</span><span class="token punctuation">,</span> 
              <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> 
            <span class="token punctuation">{</span>
              <span class="token property">"startPc"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> 
              <span class="token property">"length"</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span> 
              <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"str"</span><span class="token punctuation">,</span> 
              <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"Ljava/lang/String;"</span><span class="token punctuation">,</span> 
              <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">2</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解析<code>Code</code>的指令集时需要对照指令集映射表，然后根据不同的指令实现不一样的指令处理逻辑，指令列表和详细的描述请参考：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-6.html#jvms-6.5">JVM规范-指令</a>。</p>
<h1 id="五、Java虚拟机指令集"><a href="#五、Java虚拟机指令集" class="headerlink" title="五、Java虚拟机指令集"></a>五、Java虚拟机指令集</h1><p>在上一章节我们解析了<code>Code</code>属性，并从中解析出了一些虚拟机指令，本章节我们将深入学习Java虚拟机的指令集。</p>
<h2 id="5-1-类型-方法描述符"><a href="#5-1-类型-方法描述符" class="headerlink" title="5.1 类型/方法描述符"></a>5.1 类型/方法描述符</h2><p>Java虚拟机中描述类型和方法有固定的描述符和Java语法中所所用的完全不一样，比如<code>int</code>应当表示为<code>i</code>，表示一个java类名，如：<code>java.lang.Object</code>类在虚拟机中应该使用<code>java/lang/Object</code>，表示引用对象应当使<code>L类名;</code>如：<code>Object obj</code>应当使用<code>Ljava/lang/Object;</code>表示，表示成员方法时候应当使用(参数类型描述符)返回值，如：<code>void main(String[] args)</code>应当使用<code>([Ljava/lang/String;)V</code>表示，表示数组使用<code>[类型描述符</code>，如<code>int[]</code>应当使用<code>[i</code>表示，表示构造方法名称应当使用<code>&lt;init&gt;</code>表示。</p>
<ul>
<li><strong>类型描述符表</strong></li>
</ul>
<table>
<thead>
<tr>
<th>描述符</th>
<th>Java类型</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>B</code></td>
<td><code>byte</code></td>
<td><code>B</code></td>
</tr>
<tr>
<td><code>C</code></td>
<td><code>char</code></td>
<td><code>C</code></td>
</tr>
<tr>
<td><code>D</code></td>
<td><code>double</code></td>
<td><code>D</code></td>
</tr>
<tr>
<td><code>F</code></td>
<td><code>float</code></td>
<td><code>F</code></td>
</tr>
<tr>
<td><code>I</code></td>
<td><code>int</code></td>
<td><code>I</code></td>
</tr>
<tr>
<td><code>J</code></td>
<td><code>long</code></td>
<td><code>J</code></td>
</tr>
<tr>
<td><code>S</code></td>
<td><code>short</code></td>
<td><code>S</code></td>
</tr>
<tr>
<td><code>Z</code></td>
<td><code>boolean</code></td>
<td><code>Z</code></td>
</tr>
<tr>
<td><code>[</code></td>
<td><code>数组</code></td>
<td><code>[IJ</code></td>
</tr>
<tr>
<td><code>L类名;</code></td>
<td><code>引用类型对象</code></td>
<td><code>Ljava/lang/Object;</code></td>
</tr>
</tbody></table>
<ul>
<li><strong>方法描述符示例</strong></li>
</ul>
<table>
<thead>
<tr>
<th>方法示例</th>
<th>描述符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>static{...}</code>，<code>static int id = 1;</code></td>
<td>方法名：<code>&lt;clinit&gt;</code></td>
<td>静态语句块/静态变量初始化</td>
</tr>
<tr>
<td><code>public Test (){...}</code></td>
<td>方法名：<code>&lt;init&gt;</code>，描述符<code>()V</code></td>
<td>构造方法</td>
</tr>
<tr>
<td><code>void hello(){...}</code></td>
<td><code>()V</code></td>
<td><code>V</code>表示<code>void</code>，无返回值</td>
</tr>
<tr>
<td><code>Object login(String str) {...}</code></td>
<td><code>(Ljava/lang/String;)Ljava/lang/Object;</code></td>
<td>普通方法，返回Object类型</td>
</tr>
<tr>
<td><code>void login(String str) {...}</code></td>
<td><code>(Ljava/lang/String;)V</code></td>
<td>普通方法，无返回值</td>
</tr>
</tbody></table>
<h2 id="5-2-Java虚拟机指令"><a href="#5-2-Java虚拟机指令" class="headerlink" title="5.2 Java虚拟机指令"></a>5.2 Java虚拟机指令</h2><p>栈指令是由0-255的整型表示，在JVM规范的第六章中有完整的说明：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-6.html#jvms-6.5">JVM规范-指令</a>。不同的指令会有自己的数据结构，如<code>TABLESWITCH</code>和<code>LOOKUPSWITCH</code>表示的是<code>switch</code>语句，当匹配到该指令时需要按照它特有的二进制格式解析。除此之外，新版本的JDK可能会新增指令，<code>Java15</code>所有的指令大概有205个。</p>
<p><strong>Java虚拟机指令表</strong></p>
<table>
<thead>
<tr>
<th>十六进制</th>
<th>助记符</th>
<th>指令说明</th>
</tr>
</thead>
<tbody><tr>
<td>0x00</td>
<td>nop</td>
<td>什么都不做</td>
</tr>
<tr>
<td>0x01</td>
<td>aconst_null</td>
<td>将null推送至栈顶</td>
</tr>
<tr>
<td>0x02</td>
<td>iconst_m1</td>
<td>将int型-1推送至栈顶</td>
</tr>
<tr>
<td>0x03</td>
<td>iconst_0</td>
<td>将int型0推送至栈顶</td>
</tr>
<tr>
<td>0x04</td>
<td>iconst_1</td>
<td>将int型1推送至栈顶</td>
</tr>
<tr>
<td>0x05</td>
<td>iconst_2</td>
<td>将int型2推送至栈顶</td>
</tr>
<tr>
<td>0x06</td>
<td>iconst_3</td>
<td>将int型3推送至栈顶</td>
</tr>
<tr>
<td>0x07</td>
<td>iconst_4</td>
<td>将int型4推送至栈顶</td>
</tr>
<tr>
<td>0x08</td>
<td>iconst_5</td>
<td>将int型5推送至栈顶</td>
</tr>
<tr>
<td>0x09</td>
<td>lconst_0</td>
<td>将long型0推送至栈顶</td>
</tr>
<tr>
<td>0x0a</td>
<td>lconst_1</td>
<td>将long型1推送至栈顶</td>
</tr>
<tr>
<td>0x0b</td>
<td>fconst_0</td>
<td>将float型0推送至栈顶</td>
</tr>
<tr>
<td>0x0c</td>
<td>fconst_1</td>
<td>将float型1推送至栈顶</td>
</tr>
<tr>
<td>0x0d</td>
<td>fconst_2</td>
<td>将float型2推送至栈顶</td>
</tr>
<tr>
<td>0x0e</td>
<td>dconst_0</td>
<td>将double型0推送至栈顶</td>
</tr>
<tr>
<td>0x0f</td>
<td>dconst_1</td>
<td>将double型1推送至栈顶</td>
</tr>
<tr>
<td>0x10</td>
<td>bipush</td>
<td>将单字节的常量值(-128~127)推送至栈顶</td>
</tr>
<tr>
<td>0x11</td>
<td>sipush</td>
<td>将一个短整型常量值(-32768~32767)推送至栈顶</td>
</tr>
<tr>
<td>0x12</td>
<td>ldc</td>
<td>将int, float或String型常量值从常量池中推送至栈顶</td>
</tr>
<tr>
<td>0x13</td>
<td>ldc_w</td>
<td>将int, float或String型常量值从常量池中推送至栈顶（宽索引）</td>
</tr>
<tr>
<td>0x14</td>
<td>ldc2_w</td>
<td>将long或double型常量值从常量池中推送至栈顶（宽索引）</td>
</tr>
<tr>
<td>0x15</td>
<td>iload</td>
<td>将指定的int型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x16</td>
<td>lload</td>
<td>将指定的long型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x17</td>
<td>fload</td>
<td>将指定的float型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x18</td>
<td>dload</td>
<td>将指定的double型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x19</td>
<td>aload</td>
<td>将指定的引用类型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x1a</td>
<td>iload_0</td>
<td>将第一个int型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x1b</td>
<td>iload_1</td>
<td>将第二个int型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x1c</td>
<td>iload_2</td>
<td>将第三个int型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x1d</td>
<td>iload_3</td>
<td>将第四个int型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x1e</td>
<td>lload_0</td>
<td>将第一个long型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x1f</td>
<td>lload_1</td>
<td>将第二个long型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x20</td>
<td>lload_2</td>
<td>将第三个long型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x21</td>
<td>lload_3</td>
<td>将第四个long型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x22</td>
<td>fload_0</td>
<td>将第一个float型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x23</td>
<td>fload_1</td>
<td>将第二个float型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x24</td>
<td>fload_2</td>
<td>将第三个float型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x25</td>
<td>fload_3</td>
<td>将第四个float型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x26</td>
<td>dload_0</td>
<td>将第一个double型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x27</td>
<td>dload_1</td>
<td>将第二个double型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x28</td>
<td>dload_2</td>
<td>将第三个double型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x29</td>
<td>dload_3</td>
<td>将第四个double型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x2a</td>
<td>aload_0</td>
<td>将第一个引用类型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x2b</td>
<td>aload_1</td>
<td>将第二个引用类型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x2c</td>
<td>aload_2</td>
<td>将第三个引用类型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x2d</td>
<td>aload_3</td>
<td>将第四个引用类型本地变量推送至栈顶</td>
</tr>
<tr>
<td>0x2e</td>
<td>iaload</td>
<td>将int型数组指定索引的值推送至栈顶</td>
</tr>
<tr>
<td>0x2f</td>
<td>laload</td>
<td>将long型数组指定索引的值推送至栈顶</td>
</tr>
<tr>
<td>0x30</td>
<td>faload</td>
<td>将float型数组指定索引的值推送至栈顶</td>
</tr>
<tr>
<td>0x31</td>
<td>daload</td>
<td>将double型数组指定索引的值推送至栈顶</td>
</tr>
<tr>
<td>0x32</td>
<td>aaload</td>
<td>将引用型数组指定索引的值推送至栈顶</td>
</tr>
<tr>
<td>0x33</td>
<td>baload</td>
<td>将boolean或byte型数组指定索引的值推送至栈顶</td>
</tr>
<tr>
<td>0x34</td>
<td>caload</td>
<td>将char型数组指定索引的值推送至栈顶</td>
</tr>
<tr>
<td>0x35</td>
<td>saload</td>
<td>将short型数组指定索引的值推送至栈顶</td>
</tr>
<tr>
<td>0x36</td>
<td>istore</td>
<td>将栈顶int型数值存入指定本地变量</td>
</tr>
<tr>
<td>0x37</td>
<td>lstore</td>
<td>将栈顶long型数值存入指定本地变量</td>
</tr>
<tr>
<td>0x38</td>
<td>fstore</td>
<td>将栈顶float型数值存入指定本地变量</td>
</tr>
<tr>
<td>0x39</td>
<td>dstore</td>
<td>将栈顶double型数值存入指定本地变量</td>
</tr>
<tr>
<td>0x3a</td>
<td>astore</td>
<td>将栈顶引用型数值存入指定本地变量</td>
</tr>
<tr>
<td>0x3b</td>
<td>istore_0</td>
<td>将栈顶int型数值存入第一个本地变量</td>
</tr>
<tr>
<td>0x3c</td>
<td>istore_1</td>
<td>将栈顶int型数值存入第二个本地变量</td>
</tr>
<tr>
<td>0x3d</td>
<td>istore_2</td>
<td>将栈顶int型数值存入第三个本地变量</td>
</tr>
<tr>
<td>0x3e</td>
<td>istore_3</td>
<td>将栈顶int型数值存入第四个本地变量</td>
</tr>
<tr>
<td>0x3f</td>
<td>lstore_0</td>
<td>将栈顶long型数值存入第一个本地变量</td>
</tr>
<tr>
<td>0x40</td>
<td>lstore_1</td>
<td>将栈顶long型数值存入第二个本地变量</td>
</tr>
<tr>
<td>0x41</td>
<td>lstore_2</td>
<td>将栈顶long型数值存入第三个本地变量</td>
</tr>
<tr>
<td>0x42</td>
<td>lstore_3</td>
<td>将栈顶long型数值存入第四个本地变量</td>
</tr>
<tr>
<td>0x43</td>
<td>fstore_0</td>
<td>将栈顶float型数值存入第一个本地变量</td>
</tr>
<tr>
<td>0x44</td>
<td>fstore_1</td>
<td>将栈顶float型数值存入第二个本地变量</td>
</tr>
<tr>
<td>0x45</td>
<td>fstore_2</td>
<td>将栈顶float型数值存入第三个本地变量</td>
</tr>
<tr>
<td>0x46</td>
<td>fstore_3</td>
<td>将栈顶float型数值存入第四个本地变量</td>
</tr>
<tr>
<td>0x47</td>
<td>dstore_0</td>
<td>将栈顶double型数值存入第一个本地变量</td>
</tr>
<tr>
<td>0x48</td>
<td>dstore_1</td>
<td>将栈顶double型数值存入第二个本地变量</td>
</tr>
<tr>
<td>0x49</td>
<td>dstore_2</td>
<td>将栈顶double型数值存入第三个本地变量</td>
</tr>
<tr>
<td>0x4a</td>
<td>dstore_3</td>
<td>将栈顶double型数值存入第四个本地变量</td>
</tr>
<tr>
<td>0x4b</td>
<td>astore_0</td>
<td>将栈顶引用型数值存入第一个本地变量</td>
</tr>
<tr>
<td>0x4c</td>
<td>astore_1</td>
<td>将栈顶引用型数值存入第二个本地变量</td>
</tr>
<tr>
<td>0x4d</td>
<td>astore_2</td>
<td>将栈顶引用型数值存入第三个本地变量</td>
</tr>
<tr>
<td>0x4e</td>
<td>astore_3</td>
<td>将栈顶引用型数值存入第四个本地变量</td>
</tr>
<tr>
<td>0x4f</td>
<td>iastore</td>
<td>将栈顶int型数值存入指定数组的指定索引位置</td>
</tr>
<tr>
<td>0x50</td>
<td>lastore</td>
<td>将栈顶long型数值存入指定数组的指定索引位置</td>
</tr>
<tr>
<td>0x51</td>
<td>fastore</td>
<td>将栈顶float型数值存入指定数组的指定索引位置</td>
</tr>
<tr>
<td>0x52</td>
<td>dastore</td>
<td>将栈顶double型数值存入指定数组的指定索引位置</td>
</tr>
<tr>
<td>0x53</td>
<td>aastore</td>
<td>将栈顶引用型数值存入指定数组的指定索引位置</td>
</tr>
<tr>
<td>0x54</td>
<td>bastore</td>
<td>将栈顶boolean或byte型数值存入指定数组的指定索引位置</td>
</tr>
<tr>
<td>0x55</td>
<td>castore</td>
<td>将栈顶char型数值存入指定数组的指定索引位置</td>
</tr>
<tr>
<td>0x56</td>
<td>sastore</td>
<td>将栈顶short型数值存入指定数组的指定索引位置</td>
</tr>
<tr>
<td>0x57</td>
<td>pop</td>
<td>将栈顶数值弹出 (数值不能是long或double类型的)</td>
</tr>
<tr>
<td>0x58</td>
<td>pop2</td>
<td>将栈顶的一个（long或double类型的)或两个数值弹出（其它）</td>
</tr>
<tr>
<td>0x59</td>
<td>dup</td>
<td>复制栈顶数值并将复制值压入栈顶</td>
</tr>
<tr>
<td>0x5a</td>
<td>dup_x1</td>
<td>复制栈顶数值并将两个复制值压入栈顶</td>
</tr>
<tr>
<td>0x5b</td>
<td>dup_x2</td>
<td>复制栈顶数值并将三个（或两个）复制值压入栈顶</td>
</tr>
<tr>
<td>0x5c</td>
<td>dup2</td>
<td>复制栈顶一个（long或double类型的)或两个（其它）数值并将复制值压入栈顶</td>
</tr>
<tr>
<td>0x5d</td>
<td>dup2_x1</td>
<td>&lt;待补充&gt;</td>
</tr>
<tr>
<td>0x5e</td>
<td>dup2_x2</td>
<td>&lt;待补充&gt;</td>
</tr>
<tr>
<td>0x5f</td>
<td>swap</td>
<td>将栈最顶端的两个数值互换(数值不能是long或double类型的)</td>
</tr>
<tr>
<td>0x60</td>
<td>iadd</td>
<td>将栈顶两int型数值相加并将结果压入栈顶</td>
</tr>
<tr>
<td>0x61</td>
<td>ladd</td>
<td>将栈顶两long型数值相加并将结果压入栈顶</td>
</tr>
<tr>
<td>0x62</td>
<td>fadd</td>
<td>将栈顶两float型数值相加并将结果压入栈顶</td>
</tr>
<tr>
<td>0x63</td>
<td>dadd</td>
<td>将栈顶两double型数值相加并将结果压入栈顶</td>
</tr>
<tr>
<td>0x64</td>
<td>isub</td>
<td>将栈顶两int型数值相减并将结果压入栈顶</td>
</tr>
<tr>
<td>0x65</td>
<td>lsub</td>
<td>将栈顶两long型数值相减并将结果压入栈顶</td>
</tr>
<tr>
<td>0x66</td>
<td>fsub</td>
<td>将栈顶两float型数值相减并将结果压入栈顶</td>
</tr>
<tr>
<td>0x67</td>
<td>dsub</td>
<td>将栈顶两double型数值相减并将结果压入栈顶</td>
</tr>
<tr>
<td>0x68</td>
<td>imul</td>
<td>将栈顶两int型数值相乘并将结果压入栈顶</td>
</tr>
<tr>
<td>0x69</td>
<td>lmul</td>
<td>将栈顶两long型数值相乘并将结果压入栈顶</td>
</tr>
<tr>
<td>0x6a</td>
<td>fmul</td>
<td>将栈顶两float型数值相乘并将结果压入栈顶</td>
</tr>
<tr>
<td>0x6b</td>
<td>dmul</td>
<td>将栈顶两double型数值相乘并将结果压入栈顶</td>
</tr>
<tr>
<td>0x6c</td>
<td>idiv</td>
<td>将栈顶两int型数值相除并将结果压入栈顶</td>
</tr>
<tr>
<td>0x6d</td>
<td>ldiv</td>
<td>将栈顶两long型数值相除并将结果压入栈顶</td>
</tr>
<tr>
<td>0x6e</td>
<td>fdiv</td>
<td>将栈顶两float型数值相除并将结果压入栈顶</td>
</tr>
<tr>
<td>0x6f</td>
<td>ddiv</td>
<td>将栈顶两double型数值相除并将结果压入栈顶</td>
</tr>
<tr>
<td>0x70</td>
<td>irem</td>
<td>将栈顶两int型数值作取模运算并将结果压入栈顶</td>
</tr>
<tr>
<td>0x71</td>
<td>lrem</td>
<td>将栈顶两long型数值作取模运算并将结果压入栈顶</td>
</tr>
<tr>
<td>0x72</td>
<td>frem</td>
<td>将栈顶两float型数值作取模运算并将结果压入栈顶</td>
</tr>
<tr>
<td>0x73</td>
<td>drem</td>
<td>将栈顶两double型数值作取模运算并将结果压入栈顶</td>
</tr>
<tr>
<td>0x74</td>
<td>ineg</td>
<td>将栈顶int型数值取负并将结果压入栈顶</td>
</tr>
<tr>
<td>0x75</td>
<td>lneg</td>
<td>将栈顶long型数值取负并将结果压入栈顶</td>
</tr>
<tr>
<td>0x76</td>
<td>fneg</td>
<td>将栈顶float型数值取负并将结果压入栈顶</td>
</tr>
<tr>
<td>0x77</td>
<td>dneg</td>
<td>将栈顶double型数值取负并将结果压入栈顶</td>
</tr>
<tr>
<td>0x78</td>
<td>ishl</td>
<td>将int型数值左移位指定位数并将结果压入栈顶</td>
</tr>
<tr>
<td>0x79</td>
<td>lshl</td>
<td>将long型数值左移位指定位数并将结果压入栈顶</td>
</tr>
<tr>
<td>0x7a</td>
<td>ishr</td>
<td>将int型数值右（符号）移位指定位数并将结果压入栈顶</td>
</tr>
<tr>
<td>0x7b</td>
<td>lshr</td>
<td>将long型数值右（符号）移位指定位数并将结果压入栈顶</td>
</tr>
<tr>
<td>0x7c</td>
<td>iushr</td>
<td>将int型数值右（无符号）移位指定位数并将结果压入栈顶</td>
</tr>
<tr>
<td>0x7d</td>
<td>lushr</td>
<td>将long型数值右（无符号）移位指定位数并将结果压入栈顶</td>
</tr>
<tr>
<td>0x7e</td>
<td>iand</td>
<td>将栈顶两int型数值作“按位与”并将结果压入栈顶</td>
</tr>
<tr>
<td>0x7f</td>
<td>land</td>
<td>将栈顶两long型数值作“按位与”并将结果压入栈顶</td>
</tr>
<tr>
<td>0x80</td>
<td>ior</td>
<td>将栈顶两int型数值作“按位或”并将结果压入栈顶</td>
</tr>
<tr>
<td>0x81</td>
<td>lor</td>
<td>将栈顶两long型数值作“按位或”并将结果压入栈顶</td>
</tr>
<tr>
<td>0x82</td>
<td>ixor</td>
<td>将栈顶两int型数值作“按位异或”并将结果压入栈顶</td>
</tr>
<tr>
<td>0x83</td>
<td>lxor</td>
<td>将栈顶两long型数值作“按位异或”并将结果压入栈顶</td>
</tr>
<tr>
<td>0x84</td>
<td>iinc</td>
<td>将指定int型变量增加指定值（i++, i–, i+=2）</td>
</tr>
<tr>
<td>0x85</td>
<td>i2l</td>
<td>将栈顶int型数值强制转换成long型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x86</td>
<td>i2f</td>
<td>将栈顶int型数值强制转换成float型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x87</td>
<td>i2d</td>
<td>将栈顶int型数值强制转换成double型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x88</td>
<td>l2i</td>
<td>将栈顶long型数值强制转换成int型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x89</td>
<td>l2f</td>
<td>将栈顶long型数值强制转换成float型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x8a</td>
<td>l2d</td>
<td>将栈顶long型数值强制转换成double型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x8b</td>
<td>f2i</td>
<td>将栈顶float型数值强制转换成int型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x8c</td>
<td>f2l</td>
<td>将栈顶float型数值强制转换成long型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x8d</td>
<td>f2d</td>
<td>将栈顶float型数值强制转换成double型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x8e</td>
<td>d2i</td>
<td>将栈顶double型数值强制转换成int型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x8f</td>
<td>d2l</td>
<td>将栈顶double型数值强制转换成long型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x90</td>
<td>d2f</td>
<td>将栈顶double型数值强制转换成float型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x91</td>
<td>i2b</td>
<td>将栈顶int型数值强制转换成byte型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x92</td>
<td>i2c</td>
<td>将栈顶int型数值强制转换成char型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x93</td>
<td>i2s</td>
<td>将栈顶int型数值强制转换成short型数值并将结果压入栈顶</td>
</tr>
<tr>
<td>0x94</td>
<td>lcmp</td>
<td>比较栈顶两long型数值大小，并将结果（1，0，-1）压入栈顶</td>
</tr>
<tr>
<td>0x95</td>
<td>fcmpl</td>
<td>比较栈顶两float型数值大小，并将结果（1，0，-1）压入栈顶；当其中一个数值为NaN时，将-1压入栈顶</td>
</tr>
<tr>
<td>0x96</td>
<td>fcmpg</td>
<td>比较栈顶两float型数值大小，并将结果（1，0，-1）压入栈顶；当其中一个数值为NaN时，将1压入栈顶</td>
</tr>
<tr>
<td>0x97</td>
<td>dcmpl</td>
<td>比较栈顶两double型数值大小，并将结果（1，0，-1）压入栈顶；当其中一个数值为NaN时，将-1压入栈顶</td>
</tr>
<tr>
<td>0x98</td>
<td>dcmpg</td>
<td>比较栈顶两double型数值大小，并将结果（1，0，-1）压入栈顶；当其中一个数值为NaN时，将1压入栈顶</td>
</tr>
<tr>
<td>0x99</td>
<td>ifeq</td>
<td>当栈顶int型数值等于0时跳转</td>
</tr>
<tr>
<td>0x9a</td>
<td>ifne</td>
<td>当栈顶int型数值不等于0时跳转</td>
</tr>
<tr>
<td>0x9b</td>
<td>iflt</td>
<td>当栈顶int型数值小于0时跳转</td>
</tr>
<tr>
<td>0x9c</td>
<td>ifge</td>
<td>当栈顶int型数值大于等于0时跳转</td>
</tr>
<tr>
<td>0x9d</td>
<td>ifgt</td>
<td>当栈顶int型数值大于0时跳转</td>
</tr>
<tr>
<td>0x9e</td>
<td>ifle</td>
<td>当栈顶int型数值小于等于0时跳转</td>
</tr>
<tr>
<td>0x9f</td>
<td>if_icmpeq</td>
<td>比较栈顶两int型数值大小，当结果等于0时跳转</td>
</tr>
<tr>
<td>0xa0</td>
<td>if_icmpne</td>
<td>比较栈顶两int型数值大小，当结果不等于0时跳转</td>
</tr>
<tr>
<td>0xa1</td>
<td>if_icmplt</td>
<td>比较栈顶两int型数值大小，当结果小于0时跳转</td>
</tr>
<tr>
<td>0xa2</td>
<td>if_icmpge</td>
<td>比较栈顶两int型数值大小，当结果大于等于0时跳转</td>
</tr>
<tr>
<td>0xa3</td>
<td>if_icmpgt</td>
<td>比较栈顶两int型数值大小，当结果大于0时跳转</td>
</tr>
<tr>
<td>0xa4</td>
<td>if_icmple</td>
<td>比较栈顶两int型数值大小，当结果小于等于0时跳转</td>
</tr>
<tr>
<td>0xa5</td>
<td>if_acmpeq</td>
<td>比较栈顶两引用型数值，当结果相等时跳转</td>
</tr>
<tr>
<td>0xa6</td>
<td>if_acmpne</td>
<td>比较栈顶两引用型数值，当结果不相等时跳转</td>
</tr>
<tr>
<td>0xa7</td>
<td>goto</td>
<td>无条件跳转</td>
</tr>
<tr>
<td>0xa8</td>
<td>jsr</td>
<td>跳转至指定16位offset位置，并将jsr下一条指令地址压入栈顶</td>
</tr>
<tr>
<td>0xa9</td>
<td>ret</td>
<td>返回至本地变量指定的index的指令位置（一般与jsr, jsr_w联合使用）</td>
</tr>
<tr>
<td>0xaa</td>
<td>tableswitch</td>
<td>用于switch条件跳转，case值连续（可变长度指令）</td>
</tr>
<tr>
<td>0xab</td>
<td>lookupswitch</td>
<td>用于switch条件跳转，case值不连续（可变长度指令）</td>
</tr>
<tr>
<td>0xac</td>
<td>ireturn</td>
<td>从当前方法返回int</td>
</tr>
<tr>
<td>0xad</td>
<td>lreturn</td>
<td>从当前方法返回long</td>
</tr>
<tr>
<td>0xae</td>
<td>freturn</td>
<td>从当前方法返回float</td>
</tr>
<tr>
<td>0xaf</td>
<td>dreturn</td>
<td>从当前方法返回double</td>
</tr>
<tr>
<td>0xb0</td>
<td>areturn</td>
<td>从当前方法返回对象引用</td>
</tr>
<tr>
<td>0xb1</td>
<td>return</td>
<td>从当前方法返回void</td>
</tr>
<tr>
<td>0xb2</td>
<td>getstatic</td>
<td>获取指定类的静态域，并将其值压入栈顶</td>
</tr>
<tr>
<td>0xb3</td>
<td>putstatic</td>
<td>为指定的类的静态域赋值</td>
</tr>
<tr>
<td>0xb4</td>
<td>getfield</td>
<td>获取指定类的实例域，并将其值压入栈顶</td>
</tr>
<tr>
<td>0xb5</td>
<td>putfield</td>
<td>为指定的类的实例域赋值</td>
</tr>
<tr>
<td>0xb6</td>
<td>invokevirtual</td>
<td>调用实例方法</td>
</tr>
<tr>
<td>0xb7</td>
<td>invokespecial</td>
<td>调用超类构造方法，实例初始化方法，私有方法</td>
</tr>
<tr>
<td>0xb8</td>
<td>invokestatic</td>
<td>调用静态方法</td>
</tr>
<tr>
<td>0xb9</td>
<td>invokeinterface</td>
<td>调用接口方法</td>
</tr>
<tr>
<td>0xba</td>
<td>–</td>
<td></td>
</tr>
<tr>
<td>0xbb</td>
<td>new</td>
<td>创建一个对象，并将其引用值压入栈顶</td>
</tr>
<tr>
<td>0xbc</td>
<td>newarray</td>
<td>创建一个指定原始类型（如int, float, char…）的数组，并将其引用值压入栈顶</td>
</tr>
<tr>
<td>0xbd</td>
<td>anewarray</td>
<td>创建一个引用型（如类，接口，数组）的数组，并将其引用值压入栈顶</td>
</tr>
<tr>
<td>0xbe</td>
<td>arraylength</td>
<td>获得数组的长度值并压入栈顶</td>
</tr>
<tr>
<td>0xbf</td>
<td>athrow</td>
<td>将栈顶的异常抛出</td>
</tr>
<tr>
<td>0xc0</td>
<td>checkcast</td>
<td>检验类型转换，检验未通过将抛出ClassCastException</td>
</tr>
<tr>
<td>0xc1</td>
<td>instanceof</td>
<td>检验对象是否是指定的类的实例，如果是将1压入栈顶，否则将0压入栈顶</td>
</tr>
<tr>
<td>0xc2</td>
<td>monitorenter</td>
<td>获得对象的锁，用于同步方法或同步块</td>
</tr>
<tr>
<td>0xc3</td>
<td>monitorexit</td>
<td>释放对象的锁，用于同步方法或同步块</td>
</tr>
<tr>
<td>0xc4</td>
<td>wide</td>
<td>&lt;待补充&gt;</td>
</tr>
<tr>
<td>0xc5</td>
<td>multianewarray</td>
<td>创建指定类型和指定维度的多维数组（执行该指令时，操作栈中必须包含各维度的长度值），并将其引用值压入栈顶</td>
</tr>
<tr>
<td>0xc6</td>
<td>ifnull</td>
<td>为null时跳转</td>
</tr>
<tr>
<td>0xc7</td>
<td>ifnonnull</td>
<td>不为null时跳转</td>
</tr>
<tr>
<td>0xc8</td>
<td>goto_w</td>
<td>无条件跳转（宽索引）</td>
</tr>
<tr>
<td>0xc9</td>
<td>jsr_w</td>
<td>跳转至指定32位offset位置，并将jsr_w下一条指令地址压入栈顶</td>
</tr>
</tbody></table>
<ul>
<li>指令解析</li>
</ul>
<p>为了便于理解，以<code>TestHelloWorld</code>类中有一个<code>hello</code>方法为例，学习字节码和源代码之间的关联性。</p>
<p><strong>TestHelloWorld类的hello方法代码如下：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"Hello:"</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> str <span class="token operator">+</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>hello</code>方法是一个非静态方法，返回值是<code>String</code>，<code>hello</code>方法有一个<code>String</code>类型的参数。</p>
<p>编译后的栈指令如下：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"opcodes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"ldc #3 &lt;Hello:&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"astore_2"</span><span class="token punctuation">,</span> 
        <span class="token string">"new #4 &lt;java/lang/StringBuilder&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"dup"</span><span class="token punctuation">,</span> 
        <span class="token string">"invokespecial #5 &lt;java/lang/StringBuilder.&lt;init&gt;&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"aload_2"</span><span class="token punctuation">,</span> 
        <span class="token string">"invokevirtual #6 &lt;java/lang/StringBuilder.append&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"aload_1"</span><span class="token punctuation">,</span> 
        <span class="token string">"invokevirtual #6 &lt;java/lang/StringBuilder.append&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"invokevirtual #7 &lt;java/lang/StringBuilder.toString&gt;"</span><span class="token punctuation">,</span> 
        <span class="token string">"areturn"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>hello方法字节码解析</li>
</ul>
<p>虽然<code>hello</code>方法的代码非常简单，但是翻译成指令后就会变得比较难以理解了，有很多细节是隐藏在编译细节中的，比如<code>return str + content;</code>是一个简单的两个字符串相加的操作，但实际上<code>javac</code>编译时会创建一个<code>StringBuilder</code>对象，然后调用<code>append</code>方法来实现<code>str</code>字符串和<code>content</code>字符串相加的。</p>
<p><strong>hello方法字节码解析：</strong></p>
<ol>
<li><code>ldc</code>表示的是将int, float或String型常量值从常量池中推送至栈顶，而<code>ldc #3</code>表示的是将常量池中的第三个索引位置压入栈顶，也就是<code>Hello:</code>；</li>
<li><code>astore_2</code>表示的是将栈顶的值存入到<code>局部变量表</code>的第二个位置，<code>局部变量表</code>的索引位置是从0开始的，因为<code>hello</code>方法是一个非静态方法，所以索引0表示的是<code>this</code>对象（如果是<code>static</code>方法那么就意味着没有<code>this</code>对象，索引0就应该表示第一个参数）。索引1表示的是<code>hello</code>方法的第一个参数，也就是<code>String content</code>。如果在方法体中想创建一个新的对象，那么就必须计算这个变量在局部变量表中的索引位置，否则无法存储对象。还有一个需要特别注意的点是<code>long</code>和<code>double</code>是宽类型(<code>wide type</code>)需要占用两个索引位置。<code>astore_2</code>实际上表达的是将栈顶的对象压入到局部变量表中，等价于<code>String arg2 = new String("Hello:")</code>；</li>
<li><code>new #4</code>表示的是创建<code>java/lang/StringBuilder</code>类实例；</li>
<li><code>dup</code>表示复制栈顶数值并将复制值压入栈顶，即<code>StringBuilder</code>对象；</li>
<li><code>invokespecial #5</code>，<code>invokespecial</code>表示的是调用超类构造方法，实例初始化方法，私有方法，即调用<code>StringBuilder</code>类的构造方法(<code>&lt;init&gt;</code>)，<code>#5</code>在常量池中是一个<code>CONSTANT_METHOD_REF</code>类型的对象，用于表示一个类方法引用，<code>invokespecial #5</code>实际上是在调用的<code>StringBuilder</code>的构造方法，等价于：<code>new StringBuilder()</code>；</li>
<li><code>aload_2</code>表示的是加载局部变量表中的第二个变量，也就是读取<code>astore_2</code>存入的值，即<code>Hello:</code>。</li>
<li><code>invokevirtual #6</code>表示的是调用<code>StringBuilder</code>类的<code>append</code>方法，等价于：<code>sb.append("Hello:")</code>；</li>
<li><code>aload_1</code>表示的是将局部变量表中的第一个变量压入栈顶，也就是将<code>hello</code>方法的第一个参数<code>content</code>的值压入栈顶；</li>
<li><code>invokevirtual #6</code>，再次调用<code>StringBuilder</code>类的<code>append</code>方法，等价于：<code>sb.append(content)</code>；</li>
<li><code>invokevirtual #7</code>，调用<code>StringBuilder</code>类的<code>toString</code>方法，等价于：<code>sb.toString()</code>；</li>
<li><code>areturn</code>表示的是返回一个引用类型对象，需要注意的是如果不同的数据类型需要使用正确的return指令；</li>
</ol>
<p><code>hello</code>方法的逻辑非常简单，如果只是看源代码的情况下我们可以秒懂该方法的执行流程和逻辑，但是如果我们从字节码层来看就会显得非常复杂不便于阅读；从第3步到第10步实际上只是在做源代码中的<code>str + content</code>字符串相加操作而已。正是因为直接阅读虚拟机的指令对我们是一种非常不好的体验，所以才会有根据字节码逆向生成Java源代码的需求，通过反编译工具我们能够非常好的阅读程序逻辑，从而省去阅读字节码和指令的压力。但是反编译工具不是万能的，某些时候在解析指令的时候可能会报错，甚至是崩溃，所以为了更好的分析类业务逻辑以及学习<code>ASM</code>字节码库，我们需要尽可能的掌握字节码解析和虚拟机指令解析的原理。</p>
<h1 id="六、Java-类字节码编辑-ASM"><a href="#六、Java-类字节码编辑-ASM" class="headerlink" title="六、Java 类字节码编辑 - ASM"></a>六、Java 类字节码编辑 - ASM</h1><p>Java字节码库允许我们通过字节码库的API动态创建或修改Java类、方法、变量等操作而被广泛使用，本节将讲解ASM库的使用。</p>
<p>ASM是一种通用Java字节码操作和分析框架，它可以直接以二进制形式修改一个现有的类或动态生成类文件。ASM的版本更新快（<code>ASM 9.0</code>已经支持<code>JDK 16</code>）、<a target="_blank" rel="noopener" href="https://asm.ow2.io/performance.html">性能高</a>、功能全，学习成本也相对较高，ASM官方用户手册：<a target="_blank" rel="noopener" href="https://asm.ow2.io/asm4-guide.pdf">ASM 4.0 A Java bytecode engineering library</a>。</p>
<p>ASM提供了三个基于<code>ClassVisitor API</code>的核心API，用于生成和转换类：</p>
<ol>
<li><code>ClassReader</code>类用于解析class文件或二进制流；</li>
<li><code>ClassWriter</code>类是<code>ClassVisitor</code>的子类，用于生成类二进制；</li>
<li><code>ClassVisitor</code>是一个抽象类，自定义<code>ClassVisitor</code>重写<code>visitXXX</code>方法，可获取捕获ASM类结构访问的所有事件；</li>
</ol>
<h2 id="6-1-ClassReader和ClassVisitor"><a href="#6-1-ClassReader和ClassVisitor" class="headerlink" title="6.1 ClassReader和ClassVisitor"></a>6.1 ClassReader和ClassVisitor</h2><p><code>ClassReader</code>类用于解析类字节码，创建<code>ClassReader</code>对象可传入类名、类字节码数组或者类输入流对象。</p>
<p>创建完<code>ClassReader</code>对象就会触发字节码解析（解析class基础信息，如常量池、接口信息等），所以可以直接通过<code>ClassReader</code>对象获取类的基础信息，如下：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 创建ClassReader对象，用于解析类对象，可以根据类名、二进制、输入流的方式创建</span>
<span class="token keyword">final</span> <span class="token class-name">ClassReader</span> cr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassReader</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
        <span class="token string">"解析类名："</span> <span class="token operator">+</span> cr<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，父类："</span> <span class="token operator">+</span> cr<span class="token punctuation">.</span><span class="token function">getSuperName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        <span class="token string">"，实现接口："</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>cr<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>调用<code>ClassReader</code>类的<code>accpet</code>方法需要传入自定义的<code>ClassVisitor</code>对象，<code>ClassReader</code>会按照如下顺序，依次调用该<code>ClassVisitor</code>的类方法。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">visit
        <span class="token punctuation">[</span> visitSource <span class="token punctuation">]</span> <span class="token punctuation">[</span> visitModule <span class="token punctuation">]</span><span class="token punctuation">[</span> visitNestHost <span class="token punctuation">]</span><span class="token punctuation">[</span> visitPermittedclass <span class="token punctuation">]</span><span class="token punctuation">[</span> visitOuterClass <span class="token punctuation">]</span>
        <span class="token punctuation">(</span> visitAnnotation <span class="token operator">|</span> visitTypeAnnotation <span class="token operator">|</span> visitAttribute <span class="token punctuation">)</span><span class="token operator">*</span>
        <span class="token punctuation">(</span> visitNestMember <span class="token operator">|</span> visitInnerClass <span class="token operator">|</span> visitRecordComponent <span class="token operator">|</span> visitField <span class="token operator">|</span> visitMethod <span class="token punctuation">)</span><span class="token operator">*</span>
        visitEnd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ClassVisitor类图：</strong></p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201020185201582.png" style="zoom:67%;">

<h2 id="6-2-MethodVisitor和AdviceAdapter"><a href="#6-2-MethodVisitor和AdviceAdapter" class="headerlink" title="6.2 MethodVisitor和AdviceAdapter"></a>6.2 MethodVisitor和AdviceAdapter</h2><p><code>MethodVisitor</code>同<code>ClassVisitor</code>，重写<code>MethodVisitor</code>类方法可获取捕获到对应的<code>visit</code>事件，<code>MethodVisitor</code>会依次按照如下顺序调用<code>visit</code>方法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">(</span> visitParameter <span class="token punctuation">)</span><span class="token operator">*</span> <span class="token punctuation">[</span> visitAnnotationDefault <span class="token punctuation">]</span> 
  <span class="token punctuation">(</span> visitAnnotation <span class="token operator">|</span> visitAnnotableParameterCount <span class="token operator">|</span> visitParameterAnnotation visitTypeAnnotation <span class="token operator">|</span> visitAttribute <span class="token punctuation">)</span><span class="token operator">*</span> 
  <span class="token punctuation">[</span> visitCode 
   <span class="token punctuation">(</span> visitFrame <span class="token operator">|</span> visit<span class="token generics"><span class="token punctuation">&lt;</span>i<span class="token punctuation">&gt;</span></span><span class="token class-name">X</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span><span class="token class-name">Insn</span> <span class="token operator">|</span> visitLabel <span class="token operator">|</span> visitInsnAnnotation <span class="token operator">|</span> visitTryCatchBlock <span class="token operator">|</span> visitTryCatchAnnotation <span class="token operator">|</span> visitLocalVariable <span class="token operator">|</span> visitLocalVariableAnnotation <span class="token operator">|</span> visitLineNumber <span class="token punctuation">)</span><span class="token operator">*</span> 
   visitMaxs 
  <span class="token punctuation">]</span> 
visitEnd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>AdviceAdapter</code>的父类是<code>GeneratorAdapter</code>和<code>LocalVariablesSorter</code>，在<code>MethodVisitor</code>类的基础上封装了非常多的便捷方法，同时还为我们做了非常有必要的计算，所以我们应该尽可能的使用<code>AdviceAdapter</code>来修改字节码。</p>
<p><code>AdviceAdapter</code>类实现了一些非常有价值的方法，如：<code>onMethodEnter</code>（方法进入时回调方法）、<code>onMethodExit</code>（方法退出时回调方法），如果我们自己实现很容易掉进坑里面，因为这两个方法都是根据条件推算出来的。比如我们如果在构造方法的第一行直接插入了我们自己的字节码就可能会发现程序一运行就会崩溃，因为Java语法中限制我们第一行代码必须是<code>super(xxx)</code>。</p>
<p><code>GeneratorAdapter</code>封装了一些栈指令操作的方法，如<code>loadArgArray</code>方法可以直接获取方法所有参数数组、<code>invokeStatic</code>方法可以直接调用类方法、<code>push</code>方法可压入各种类型的对象等。</p>
<p>比如<code>LocalVariablesSorter</code>类实现了计算本地变量索引位置的方法，如果要在方法中插入新的局部变量就必须计算变量的索引位置，我们必须先判断是否是非静态方法、是否是<code>long/double</code>类型的参数（宽类型占两个位），否则计算出的索引位置还是错的。使用<code>AdviceAdapter</code>可以直接调用<code>mv.newLocal(type)</code>计算出本地变量存储的位置，为我们省去了许多不必要的麻烦。</p>
<h2 id="6-3-读取类-成员变量-方法信息"><a href="#6-3-读取类-成员变量-方法信息" class="headerlink" title="6.3 读取类/成员变量/方法信息"></a>6.3 读取类/成员变量/方法信息</h2><p>为了学习<code>ClassVisitor</code>，我们写一个简单的读取类、成员变量、方法信息的一个示例，需要重写<code>ClassVisitor</code>类的<code>visit</code>、<code>visitField</code>和<code>visitMethod</code>方法。</p>
<p><strong>ASM读取类信息示例代码：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span>asm</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">ClassReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">ClassVisitor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">FieldVisitor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">MethodVisitor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">ClassReader</span><span class="token punctuation">.</span><span class="token static">EXPAND_FRAMES</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">Opcodes</span><span class="token punctuation">.</span><span class="token static">ASM9</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ASMClassVisitorTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 定义需要解析的类名称</span>
        <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token string">"com.anbai.sec.bytecode.TestHelloWorld"</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 创建ClassReader对象，用于解析类对象，可以根据类名、二进制、输入流的方式创建</span>
            <span class="token keyword">final</span> <span class="token class-name">ClassReader</span> cr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassReader</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                    <span class="token string">"解析类名："</span> <span class="token operator">+</span> cr<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，父类："</span> <span class="token operator">+</span> cr<span class="token punctuation">.</span><span class="token function">getSuperName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                            <span class="token string">"，实现接口："</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>cr<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 使用自定义的ClassVisitor访问者对象，访问该类文件的结构</span>
            cr<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassVisitor</span><span class="token punctuation">(</span><span class="token constant">ASM9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">int</span> version<span class="token punctuation">,</span> <span class="token keyword">int</span> access<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span> <span class="token class-name">String</span> superName<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                            <span class="token string">"变量修饰符："</span> <span class="token operator">+</span> access <span class="token operator">+</span> <span class="token string">"\t 类名："</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"\t 父类名："</span> <span class="token operator">+</span> superName <span class="token operator">+</span>
                                    <span class="token string">"\t 实现的接口："</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>interfaces<span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>version<span class="token punctuation">,</span> access<span class="token punctuation">,</span> name<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> superName<span class="token punctuation">,</span> interfaces<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">FieldVisitor</span> <span class="token function">visitField</span><span class="token punctuation">(</span><span class="token keyword">int</span> access<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">,</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                            <span class="token string">"变量修饰符："</span> <span class="token operator">+</span> access <span class="token operator">+</span> <span class="token string">"\t 变量名称："</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"\t 描述符："</span> <span class="token operator">+</span> desc <span class="token operator">+</span> <span class="token string">"\t 默认值："</span> <span class="token operator">+</span> value
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitField</span><span class="token punctuation">(</span>access<span class="token punctuation">,</span> name<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">MethodVisitor</span> <span class="token function">visitMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> access<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">,</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> exceptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                            <span class="token string">"方法修饰符："</span> <span class="token operator">+</span> access <span class="token operator">+</span> <span class="token string">"\t 方法名称："</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"\t 描述符："</span> <span class="token operator">+</span> desc <span class="token operator">+</span>
                                    <span class="token string">"\t 抛出的异常："</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>exceptions<span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>access<span class="token punctuation">,</span> name<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> exceptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">EXPAND_FRAMES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>程序执行后输出：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">解析类名：com<span class="token operator">/</span>anbai<span class="token operator">/</span>sec<span class="token operator">/</span>bytecode<span class="token operator">/</span><span class="token class-name">TestHelloWorld</span>，父类：java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span>，实现接口：<span class="token punctuation">[</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">Serializable</span><span class="token punctuation">]</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
变量修饰符：<span class="token number">131105</span>     类名：com<span class="token operator">/</span>anbai<span class="token operator">/</span>sec<span class="token operator">/</span>bytecode<span class="token operator">/</span><span class="token class-name">TestHelloWorld</span>    父类名：java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span>    实现的接口：<span class="token punctuation">[</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">Serializable</span><span class="token punctuation">]</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
变量修饰符：<span class="token number">26</span>     变量名称：serialVersionUID   描述符：<span class="token class-name">J</span>   默认值：<span class="token operator">-</span><span class="token number">7366591802115333975</span>
变量修饰符：<span class="token number">2</span>  变量名称：id     描述符：<span class="token class-name">J</span>   默认值：<span class="token keyword">null</span>
变量修饰符：<span class="token number">2</span>  变量名称：username   描述符：<span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>  默认值：<span class="token keyword">null</span>
变量修饰符：<span class="token number">2</span>  变量名称：password   描述符：<span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>  默认值：<span class="token keyword">null</span>
方法修饰符：<span class="token number">1</span>  方法名称：<span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span>     描述符：<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>     抛出的异常：<span class="token keyword">null</span>
方法修饰符：<span class="token number">1</span>  方法名称：hello  描述符：<span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>  抛出的异常：<span class="token keyword">null</span>
方法修饰符：<span class="token number">9</span>  方法名称：main   描述符：<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>  抛出的异常：<span class="token keyword">null</span>
方法修饰符：<span class="token number">1</span>  方法名称：getId  描述符：<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">J</span>     抛出的异常：<span class="token keyword">null</span>
方法修饰符：<span class="token number">1</span>  方法名称：setId  描述符：<span class="token punctuation">(</span><span class="token class-name">J</span><span class="token punctuation">)</span><span class="token class-name">V</span>    抛出的异常：<span class="token keyword">null</span>
方法修饰符：<span class="token number">1</span>  方法名称：getUsername    描述符：<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>    抛出的异常：<span class="token keyword">null</span>
方法修饰符：<span class="token number">1</span>  方法名称：setUsername    描述符：<span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>   抛出的异常：<span class="token keyword">null</span>
方法修饰符：<span class="token number">1</span>  方法名称：getPassword    描述符：<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>    抛出的异常：<span class="token keyword">null</span>
方法修饰符：<span class="token number">1</span>  方法名称：setPassword    描述符：<span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>   抛出的异常：<span class="token keyword">null</span>
方法修饰符：<span class="token number">1</span>  方法名称：toString   描述符：<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>    抛出的异常：<span class="token keyword">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过这个简单的示例，我们可以通过ASM实现遍历一个类的基础信息。</p>
<h2 id="6-4-修改类名-方法名称-方法修饰符示例"><a href="#6-4-修改类名-方法名称-方法修饰符示例" class="headerlink" title="6.4 修改类名/方法名称/方法修饰符示例"></a>6.4 修改类名/方法名称/方法修饰符示例</h2><p>使用<code>ClassWriter</code>可以实现类修改功能，使用ASM修改类字节码时如果插入了新的局部变量、字节码，需要重新计算<code>max_stack</code>和<code>max_locals</code>，否则会导致修改后的类文件无法通过JVM校验。手动计算<code>max_stack</code>和<code>max_locals</code>是一件比较麻烦的事情，ASM为我们提供了内置的自动计算方式，只需在创建<code>ClassWriter</code>的时候传入<code>COMPUTE_FRAMES</code>即可：<code>new ClassWriter(cr, ClassWriter.COMPUTE_FRAMES);</code></p>
<p><strong>ASM修改类字节码示例代码：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span>asm</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>javaweb<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">FileUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">ClassReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">ClassVisitor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">ClassWriter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">MethodVisitor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">ClassReader</span><span class="token punctuation">.</span><span class="token static">EXPAND_FRAMES</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">ClassWriter</span><span class="token punctuation">.</span><span class="token static">COMPUTE_FRAMES</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">Opcodes</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ASMClassWriterTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 定义需要解析的类名称</span>
        <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token string">"com.anbai.sec.bytecode.TestHelloWorld"</span><span class="token punctuation">;</span>

        <span class="token comment">// 定义修改后的类名</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> newClassName <span class="token operator">=</span> <span class="token string">"JavaSecTestHelloWorld"</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 创建ClassReader对象，用于解析类对象，可以根据类名、二进制、输入流的方式创建</span>
            <span class="token keyword">final</span> <span class="token class-name">ClassReader</span> cr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassReader</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 创建ClassWriter对象，COMPUTE_FRAMES会自动计算max_stack和max_locals</span>
            <span class="token keyword">final</span> <span class="token class-name">ClassWriter</span> cw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassWriter</span><span class="token punctuation">(</span>cr<span class="token punctuation">,</span> <span class="token constant">COMPUTE_FRAMES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 使用自定义的ClassVisitor访问者对象，访问该类文件的结构</span>
            cr<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassVisitor</span><span class="token punctuation">(</span><span class="token constant">ASM9</span><span class="token punctuation">,</span> cw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">int</span> version<span class="token punctuation">,</span> <span class="token keyword">int</span> access<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span> <span class="token class-name">String</span> superName<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>version<span class="token punctuation">,</span> access<span class="token punctuation">,</span> newClassName<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> superName<span class="token punctuation">,</span> interfaces<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">MethodVisitor</span> <span class="token function">visitMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> access<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">,</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> exceptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 将"hello"方法名字修改为"hi"</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 修改方法访问修饰符，移除public属性，修改为private</span>
                        access <span class="token operator">=</span> access <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token constant">ACC_PUBLIC</span> <span class="token operator">|</span> <span class="token constant">ACC_PRIVATE</span><span class="token punctuation">;</span>

                        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>access<span class="token punctuation">,</span> <span class="token string">"hi"</span><span class="token punctuation">,</span> desc<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> exceptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>access<span class="token punctuation">,</span> name<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> exceptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">EXPAND_FRAMES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">File</span> classFilePath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"javaweb-sec-source/javase/src/main/java/com/anbai/sec/bytecode/asm/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newClassName <span class="token operator">+</span> <span class="token string">".class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 修改后的类字节码</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classBytes <span class="token operator">=</span> cw<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 写入修改后的字节码到class文件</span>
            <span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">writeByteArrayToFile</span><span class="token punctuation">(</span>classFilePath<span class="token punctuation">,</span> classBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改成功后将会生成一个名为<code>JavaSecTestHelloWorld.class</code>的新的class文件，反编译<code>JavaSecTestHelloWorld</code>类会发现该类的<code>hello</code>方法也已被修改为了<code>hi</code>，修饰符已被改为<code>private</code>，如下图：</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201021103823611.png" style="zoom:50%;">

<h2 id="6-5-修改类方法字节码"><a href="#6-5-修改类方法字节码" class="headerlink" title="6.5 修改类方法字节码"></a>6.5 修改类方法字节码</h2><p>大多数使用ASM库的目的其实是修改类方法的字节码，在原方法执行的前后动态插入新的Java代码，从而实现类似于AOP的功能。修改类方法字节码的典型应用场景如：APM和RASP；APM需要统计和分析每个类方法的执行时间，而RASP需要在Java底层API方法执行之前插入自身的检测代码，从而实现动态拦截恶意攻击。</p>
<p>假设我们需要修改<code>com.anbai.sec.bytecode.TestHelloWorld</code>类的hello方法，实现以下两个需求：</p>
<ol>
<li>在原业务逻辑执行前打印出该方法的参数值；</li>
<li>修改该方法的返回值；</li>
</ol>
<p>原业务逻辑：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"Hello:"</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> str <span class="token operator">+</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改之后的业务逻辑代码：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> var2 <span class="token operator">=</span> <span class="token string">"javasec.org"</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"Hello:"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> var4 <span class="token operator">=</span> str <span class="token operator">+</span> content<span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>var4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> var2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>借助ASM我们可以实现类方法的字节码编辑。</p>
<p><strong>修改类方法字节码实现代码：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span>asm</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>javaweb<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">FileUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>commons<span class="token punctuation">.</span></span><span class="token class-name">AdviceAdapter</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">ClassReader</span><span class="token punctuation">.</span><span class="token static">EXPAND_FRAMES</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">Opcodes</span><span class="token punctuation">.</span><span class="token static">ASM9</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ASMMethodVisitorTest</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 定义需要解析的类名称</span>
      <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token string">"com.anbai.sec.bytecode.TestHelloWorld"</span><span class="token punctuation">;</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
         <span class="token comment">// 创建ClassReader对象，用于解析类对象，可以根据类名、二进制、输入流的方式创建</span>
         <span class="token keyword">final</span> <span class="token class-name">ClassReader</span> cr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassReader</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token comment">// 创建ClassWriter对象，COMPUTE_FRAMES会自动计算max_stack和max_locals</span>
         <span class="token keyword">final</span> <span class="token class-name">ClassWriter</span> cw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassWriter</span><span class="token punctuation">(</span>cr<span class="token punctuation">,</span> <span class="token class-name">ClassWriter</span><span class="token punctuation">.</span><span class="token constant">COMPUTE_FRAMES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token comment">// 使用自定义的ClassVisitor访问者对象，访问该类文件的结构</span>
         cr<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassVisitor</span><span class="token punctuation">(</span><span class="token constant">ASM9</span><span class="token punctuation">,</span> cw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">MethodVisitor</span> <span class="token function">visitMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> access<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">,</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> exceptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token class-name">MethodVisitor</span> mv <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>access<span class="token punctuation">,</span> name<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> exceptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

                  <span class="token comment">// 创建自定义的MethodVisitor，修改原方法的字节码</span>
                  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AdviceAdapter</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> mv<span class="token punctuation">,</span> access<span class="token punctuation">,</span> name<span class="token punctuation">,</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                     <span class="token keyword">int</span> newArgIndex<span class="token punctuation">;</span>

                     <span class="token comment">// 获取String的ASM Type对象</span>
                     <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Type</span> stringType <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                     <span class="token annotation punctuation">@Override</span>
                     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onMethodEnter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 输出hello方法的第一个参数，因为hello是非static方法，所以0是this，第一个参数的下标应该是1</span>
                        mv<span class="token punctuation">.</span><span class="token function">visitFieldInsn</span><span class="token punctuation">(</span><span class="token constant">GETSTATIC</span><span class="token punctuation">,</span> <span class="token string">"java/lang/System"</span><span class="token punctuation">,</span> <span class="token string">"out"</span><span class="token punctuation">,</span> <span class="token string">"Ljava/io/PrintStream;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        mv<span class="token punctuation">.</span><span class="token function">visitVarInsn</span><span class="token punctuation">(</span><span class="token constant">ALOAD</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        mv<span class="token punctuation">.</span><span class="token function">visitMethodInsn</span><span class="token punctuation">(</span><span class="token constant">INVOKEVIRTUAL</span><span class="token punctuation">,</span> <span class="token string">"java/io/PrintStream"</span><span class="token punctuation">,</span> <span class="token string">"println"</span><span class="token punctuation">,</span> <span class="token string">"(Ljava/lang/String;)V"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// 创建一个新的局部变量，newLocal会计算出这个新局部对象的索引位置</span>
                        newArgIndex <span class="token operator">=</span> <span class="token function">newLocal</span><span class="token punctuation">(</span>stringType<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// 压入字符串到栈顶</span>
                        mv<span class="token punctuation">.</span><span class="token function">visitLdcInsn</span><span class="token punctuation">(</span><span class="token string">"javasec.org"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// 将"javasec.org"字符串压入到新生成的局部变量中，String var2 = "javasec.org";</span>
                        <span class="token function">storeLocal</span><span class="token punctuation">(</span>newArgIndex<span class="token punctuation">,</span> stringType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token punctuation">}</span>

                     <span class="token annotation punctuation">@Override</span>
                     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onMethodExit</span><span class="token punctuation">(</span><span class="token keyword">int</span> opcode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">dup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 复制栈顶的返回值</span>

                        <span class="token comment">// 创建一个新的局部变量，并获取索引位置</span>
                        <span class="token keyword">int</span> returnValueIndex <span class="token operator">=</span> <span class="token function">newLocal</span><span class="token punctuation">(</span>stringType<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// 将栈顶的返回值压入新生成的局部变量中</span>
                        <span class="token function">storeLocal</span><span class="token punctuation">(</span>returnValueIndex<span class="token punctuation">,</span> stringType<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// 输出hello方法的返回值</span>
                        mv<span class="token punctuation">.</span><span class="token function">visitFieldInsn</span><span class="token punctuation">(</span><span class="token constant">GETSTATIC</span><span class="token punctuation">,</span> <span class="token string">"java/lang/System"</span><span class="token punctuation">,</span> <span class="token string">"out"</span><span class="token punctuation">,</span> <span class="token string">"Ljava/io/PrintStream;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        mv<span class="token punctuation">.</span><span class="token function">visitVarInsn</span><span class="token punctuation">(</span><span class="token constant">ALOAD</span><span class="token punctuation">,</span> returnValueIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        mv<span class="token punctuation">.</span><span class="token function">visitMethodInsn</span><span class="token punctuation">(</span><span class="token constant">INVOKEVIRTUAL</span><span class="token punctuation">,</span> <span class="token string">"java/io/PrintStream"</span><span class="token punctuation">,</span> <span class="token string">"println"</span><span class="token punctuation">,</span> <span class="token string">"(Ljava/lang/String;)V"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// 压入方法进入(onMethodEnter)时存入到局部变量的var2值到栈顶</span>
                        <span class="token function">loadLocal</span><span class="token punctuation">(</span>newArgIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// 返回一个引用类型，即栈顶的var2字符串，return var2;</span>
                        <span class="token comment">// 需要特别注意的是不同数据类型应当使用不同的RETURN指令</span>
                        mv<span class="token punctuation">.</span><span class="token function">visitInsn</span><span class="token punctuation">(</span><span class="token constant">ARETURN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>

               <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>access<span class="token punctuation">,</span> name<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> exceptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">EXPAND_FRAMES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token class-name">File</span> classFilePath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"javaweb-sec-source/javase/src/main/java/com/anbai/sec/bytecode/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"TestHelloWorld.class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token comment">// 修改后的类字节码</span>
         <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classBytes <span class="token operator">=</span> cw<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token comment">// 写入修改后的字节码到class文件</span>
         <span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">writeByteArrayToFile</span><span class="token punctuation">(</span>classFilePath<span class="token punctuation">,</span> classBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>程序执行后会在<code>com.anbai.sec.bytecode</code>包下创建一个<code>TestHelloWorld.class</code>文件：</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201021174318013.png" style="zoom:67%;">

<p>命令行运行<code>TestHelloWorld</code>类，可以看到程序执行的逻辑已经被成功修改，输出结果如下：</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201021174453163.png" style="zoom:67%;">

<h2 id="6-6-动态创建Java类二进制"><a href="#6-6-动态创建Java类二进制" class="headerlink" title="6.6 动态创建Java类二进制"></a>6.6 动态创建Java类二进制</h2><p>在某些业务场景下我们需要动态一个类来实现一些业务，这个时候就可以使用<code>ClassWriter</code>来动态创建出一个Java类的二进制文件，然后通过自定义的类加载器就可以将我们动态生成的类加载到JVM中。假设我们需要生成一个<code>TestASMHelloWorld</code>类，代码如下：</p>
<ul>
<li><strong>示例TestASMHelloWorld类：</strong></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>classloader</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestASMHelloWorld</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"Hello World~"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>使用ClassWriter生成类字节码示例：</strong></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span>asm</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>javaweb<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">HexUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">ClassWriter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">Label</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">MethodVisitor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>objectweb<span class="token punctuation">.</span>asm<span class="token punctuation">.</span></span><span class="token class-name">Opcodes</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestASMHelloWorldDump</span> <span class="token keyword">implements</span> <span class="token class-name">Opcodes</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CLASS_NAME</span> <span class="token operator">=</span> <span class="token string">"com.anbai.sec.classloader.TestASMHelloWorld"</span><span class="token punctuation">;</span>

   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CLASS_NAME_ASM</span> <span class="token operator">=</span> <span class="token string">"com/anbai/sec/classloader/TestASMHelloWorld"</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token comment">// 创建ClassWriter，用于生成类字节码</span>
      <span class="token class-name">ClassWriter</span> cw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassWriter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 创建MethodVisitor</span>
      <span class="token class-name">MethodVisitor</span> mv<span class="token punctuation">;</span>

      <span class="token comment">// 创建一个字节码版本为JDK1.7的com.anbai.sec.classloader.TestASMHelloWorld类</span>
      cw<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token constant">V1_7</span><span class="token punctuation">,</span> <span class="token constant">ACC_PUBLIC</span> <span class="token operator">+</span> <span class="token constant">ACC_SUPER</span><span class="token punctuation">,</span> <span class="token constant">CLASS_NAME_ASM</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"java/lang/Object"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 设置源码文件名</span>
      cw<span class="token punctuation">.</span><span class="token function">visitSource</span><span class="token punctuation">(</span><span class="token string">"TestHelloWorld.java"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 创建一个空的构造方法，</span>
      <span class="token comment">// public TestASMHelloWorld() {</span>
      <span class="token comment">// }</span>
      <span class="token punctuation">{</span>
         mv <span class="token operator">=</span> cw<span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span><span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token string">"&lt;init&gt;"</span><span class="token punctuation">,</span> <span class="token string">"()V"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Label</span> l0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitLabel</span><span class="token punctuation">(</span>l0<span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitLineNumber</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> l0<span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitVarInsn</span><span class="token punctuation">(</span><span class="token constant">ALOAD</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitMethodInsn</span><span class="token punctuation">(</span><span class="token constant">INVOKESPECIAL</span><span class="token punctuation">,</span> <span class="token string">"java/lang/Object"</span><span class="token punctuation">,</span> <span class="token string">"&lt;init&gt;"</span><span class="token punctuation">,</span> <span class="token string">"()V"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitInsn</span><span class="token punctuation">(</span><span class="token constant">RETURN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Label</span> l1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitLabel</span><span class="token punctuation">(</span>l1<span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitLocalVariable</span><span class="token punctuation">(</span><span class="token string">"this"</span><span class="token punctuation">,</span> <span class="token string">"L"</span> <span class="token operator">+</span> <span class="token constant">CLASS_NAME_ASM</span> <span class="token operator">+</span> <span class="token string">";"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> l0<span class="token punctuation">,</span> l1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitMaxs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 创建一个hello方法，</span>
      <span class="token comment">// public static String hello() {</span>
      <span class="token comment">//     return "Hello World~";</span>
      <span class="token comment">// }</span>
      <span class="token punctuation">{</span>
         mv <span class="token operator">=</span> cw<span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span><span class="token constant">ACC_PUBLIC</span> <span class="token operator">+</span> <span class="token constant">ACC_STATIC</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"()Ljava/lang/String;"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Label</span> l0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitLabel</span><span class="token punctuation">(</span>l0<span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitLineNumber</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> l0<span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitLdcInsn</span><span class="token punctuation">(</span><span class="token string">"Hello World~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitInsn</span><span class="token punctuation">(</span><span class="token constant">ARETURN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitMaxs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mv<span class="token punctuation">.</span><span class="token function">visitEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      cw<span class="token punctuation">.</span><span class="token function">visitEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> cw<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classBytes <span class="token operator">=</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 输出ASM生成的TestASMHelloWorld类HEX</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">HexUtils</span><span class="token punctuation">.</span><span class="token function">hexDump</span><span class="token punctuation">(</span>classBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 创建自定义类加载器，加载ASM创建的类字节码到JVM</span>
      <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">(</span><span class="token class-name">TestASMHelloWorldDump</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token annotation punctuation">@Override</span>
         <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">findClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token constant">CLASS_NAME</span><span class="token punctuation">,</span> classBytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classBytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 反射调用通过ASM生成的TestASMHelloWorld类的hello方法，输出返回值</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello方法执行结果："</span> <span class="token operator">+</span> classLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token constant">CLASS_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>程序执行结果如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">0000019F CA FE BA BE 00 00 00 <span class="token number">33</span> 00 <span class="token number">14</span> 01 00 2B <span class="token number">63</span> 6F 6D <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.3<span class="token punctuation">..</span><span class="token punctuation">..</span>+com
000001AF 2F <span class="token number">61</span> 6E <span class="token number">62</span> <span class="token number">61</span> <span class="token number">69</span> 2F <span class="token number">73</span> <span class="token number">65</span> <span class="token number">63</span> 2F <span class="token number">63</span> 6C <span class="token number">61</span> <span class="token number">73</span> <span class="token number">73</span> /anbai/sec/class
000001BF 6C 6F <span class="token number">61</span> <span class="token number">64</span> <span class="token number">65</span> <span class="token number">72</span> 2F <span class="token number">54</span> <span class="token number">65</span> <span class="token number">73</span> <span class="token number">74</span> <span class="token number">41</span> <span class="token number">53</span> 4D <span class="token number">48</span> <span class="token number">65</span> loader/TestASMHe
000001CF 6C 6C 6F <span class="token number">57</span> 6F <span class="token number">72</span> 6C <span class="token number">64</span> 07 00 01 01 00 <span class="token number">10</span> 6A <span class="token number">61</span> lloWorld<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>ja
000001DF <span class="token number">76</span> <span class="token number">61</span> 2F 6C <span class="token number">61</span> 6E <span class="token number">67</span> 2F 4F <span class="token number">62</span> 6A <span class="token number">65</span> <span class="token number">63</span> <span class="token number">74</span> 07 00 va/lang/Object<span class="token punctuation">..</span>
000001EF 03 01 00 <span class="token number">13</span> <span class="token number">54</span> <span class="token number">65</span> <span class="token number">73</span> <span class="token number">74</span> <span class="token number">48</span> <span class="token number">65</span> 6C 6C 6F <span class="token number">57</span> 6F <span class="token number">72</span> <span class="token punctuation">..</span><span class="token punctuation">..</span>TestHelloWor
000001FF 6C <span class="token number">64</span> 2E 6A <span class="token number">61</span> <span class="token number">76</span> <span class="token number">61</span> 01 00 06 3C <span class="token number">69</span> 6E <span class="token number">69</span> <span class="token number">74</span> 3E ld.java<span class="token punctuation">..</span>.<span class="token operator">&lt;</span>init<span class="token operator">&gt;</span>
0000020F 01 00 03 <span class="token number">28</span> <span class="token number">29</span> <span class="token number">56</span> 0C 00 06 00 07 0A 00 04 00 08 <span class="token punctuation">..</span>.<span class="token punctuation">(</span><span class="token punctuation">)</span>V<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
0000021F 01 00 04 <span class="token number">74</span> <span class="token number">68</span> <span class="token number">69</span> <span class="token number">73</span> 01 00 2D 4C <span class="token number">63</span> 6F 6D 2F <span class="token number">61</span> <span class="token punctuation">..</span>.this<span class="token punctuation">..</span>-Lcom/a
0000022F 6E <span class="token number">62</span> <span class="token number">61</span> <span class="token number">69</span> 2F <span class="token number">73</span> <span class="token number">65</span> <span class="token number">63</span> 2F <span class="token number">63</span> 6C <span class="token number">61</span> <span class="token number">73</span> <span class="token number">73</span> 6C 6F nbai/sec/classlo
0000023F <span class="token number">61</span> <span class="token number">64</span> <span class="token number">65</span> <span class="token number">72</span> 2F <span class="token number">54</span> <span class="token number">65</span> <span class="token number">73</span> <span class="token number">74</span> <span class="token number">41</span> <span class="token number">53</span> 4D <span class="token number">48</span> <span class="token number">65</span> 6C 6C ader/TestASMHell
0000024F 6F <span class="token number">57</span> 6F <span class="token number">72</span> 6C <span class="token number">64</span> 3B 01 00 05 <span class="token number">68</span> <span class="token number">65</span> 6C 6C 6F 01 oWorld<span class="token punctuation">;</span><span class="token punctuation">..</span>.hello.
0000025F 00 <span class="token number">14</span> <span class="token number">28</span> <span class="token number">29</span> 4C 6A <span class="token number">61</span> <span class="token number">76</span> <span class="token number">61</span> 2F 6C <span class="token number">61</span> 6E <span class="token number">67</span> 2F <span class="token number">53</span> <span class="token punctuation">..</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Ljava/lang/S
0000026F <span class="token number">74</span> <span class="token number">72</span> <span class="token number">69</span> 6E <span class="token number">67</span> 3B 01 00 0C <span class="token number">48</span> <span class="token number">65</span> 6C 6C 6F <span class="token number">20</span> <span class="token number">57</span> tring<span class="token punctuation">;</span><span class="token punctuation">..</span>.Hello W
0000027F 6F <span class="token number">72</span> 6C <span class="token number">64</span> 7E 08 00 0E 01 00 04 <span class="token number">43</span> 6F <span class="token number">64</span> <span class="token number">65</span> 01 orld~<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>Code.
0000028F 00 0F 4C <span class="token number">69</span> 6E <span class="token number">65</span> 4E <span class="token number">75</span> 6D <span class="token number">62</span> <span class="token number">65</span> <span class="token number">72</span> <span class="token number">54</span> <span class="token number">61</span> <span class="token number">62</span> 6C <span class="token punctuation">..</span>LineNumberTabl
0000029F <span class="token number">65</span> 01 00 <span class="token number">12</span> 4C 6F <span class="token number">63</span> <span class="token number">61</span> 6C <span class="token number">56</span> <span class="token number">61</span> <span class="token number">72</span> <span class="token number">69</span> <span class="token number">61</span> <span class="token number">62</span> 6C e<span class="token punctuation">..</span>.LocalVariabl
000002AF <span class="token number">65</span> <span class="token number">54</span> <span class="token number">61</span> <span class="token number">62</span> 6C <span class="token number">65</span> 01 00 0A <span class="token number">53</span> 6F <span class="token number">75</span> <span class="token number">72</span> <span class="token number">63</span> <span class="token number">65</span> <span class="token number">46</span> eTable<span class="token punctuation">..</span>.SourceF
000002BF <span class="token number">69</span> 6C <span class="token number">65</span> 00 <span class="token number">21</span> 00 02 00 04 00 00 00 00 00 02 00 ile.<span class="token operator">!</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
000002CF 01 00 06 00 07 00 01 00 <span class="token number">10</span> 00 00 00 2F 00 01 00 <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>/<span class="token punctuation">..</span>.
000002DF 01 00 00 00 05 2A B7 00 09 B1 00 00 00 02 00 <span class="token number">11</span> <span class="token punctuation">..</span><span class="token punctuation">..</span>.*<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
000002EF 00 00 00 06 00 01 00 00 00 05 00 <span class="token number">12</span> 00 00 00 0C <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
000002FF 00 01 00 00 00 05 00 0A 00 0B 00 00 00 09 00 0C <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
0000030F 00 0D 00 01 00 <span class="token number">10</span> 00 00 00 1B 00 01 00 00 00 00 <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
0000031F 00 03 <span class="token number">12</span> 0F B0 00 00 00 01 00 <span class="token number">11</span> 00 00 00 06 00 <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
0000032F 01 00 00 00 08 00 01 00 <span class="token number">13</span> 00 00 00 02 00 05    <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.

-----------------------------------------------------------------------------
hello方法执行结果：Hello World~<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>程序执行后会在<code>TestASMHelloWorldDump</code>类同级的包下生成一个<code>TestASMHelloWorld</code>类，如下图：</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201021163840625.png" style="zoom:67%;">

<h2 id="6-7-IDEA插件"><a href="#6-7-IDEA插件" class="headerlink" title="6.7 IDEA插件"></a>6.7 IDEA插件</h2><p>初学ASM，读写ASM字节码对我们来说是非常困难的，但是我们可以借助开发工具的ASM插件，可以极大程度的帮助我们学习ASM。</p>
<h3 id="6-7-1-IDEA-ASM-Bytecode-Outline"><a href="#6-7-1-IDEA-ASM-Bytecode-Outline" class="headerlink" title="6.7.1 IDEA - ASM Bytecode Outline"></a>6.7.1 IDEA - ASM Bytecode Outline</h3><p>在IDEA中插件中心搜索：<code>ASM Bytecode Outline</code>，就可以找到ASM字节码插件，如下图：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201021193710065.png" alt="img"></p>
<p>安装完<code>ASM Bytecode Outline</code>后选择任意Java类，右键菜单中会出现<code>Show Bytecode outline</code>选项，点击之后就可以看到该类对应的ASM和Bytecode代码，如下图：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201021194226711.png" alt="img"></p>
<p>我们可以借助<code>Bytecode Outline</code>插件学习ASM，也可以直接使用<code>Bytecode Outline</code>生成的ASM代码来实现字节码编辑。</p>
<h1 id="七、Java-类字节码编辑-Javassist"><a href="#七、Java-类字节码编辑-Javassist" class="headerlink" title="七、Java 类字节码编辑 - Javassist"></a>七、Java 类字节码编辑 - Javassist</h1><p><code>Javassist</code>是一个开源的分析、编辑和创建Java字节码的类库；相比ASM，<code>Javassist</code>提供了更加简单便捷的API，使用<code>Javassist</code>我们可以像写Java代码一样直接插入Java代码片段，让我们不再需要关注Java底层的字节码的和栈操作，仅需要学会如何使用<code>Javassist</code>的API即可实现字节码编辑。学习<code>Javassist</code>可以阅读官方的入门教程：<a target="_blank" rel="noopener" href="http://www.javassist.org/tutorial/tutorial.html">Getting Started with Javassist</a>。</p>
<h2 id="7-1-Javassist-API和标识符"><a href="#7-1-Javassist-API和标识符" class="headerlink" title="7.1 Javassist API和标识符"></a>7.1 Javassist API和标识符</h2><p><code>Javassist</code>为我们提供了类似于Java反射机制的API，如：<a target="_blank" rel="noopener" href="http://www.javassist.org/html/javassist/CtClass.html">CtClass</a>，<a target="_blank" rel="noopener" href="http://www.javassist.org/html/javassist/CtConstructor.html">CtConstructor</a>、<a target="_blank" rel="noopener" href="http://www.javassist.org/html/javassist/CtMethod.html">CtMethod</a>、<a target="_blank" rel="noopener" href="http://www.javassist.org/html/javassist/CtField.html">CtField</a>与Java反射的<code>Class</code>、<code>Constructor</code>、<code>Method</code>、<code>Field</code>非常的类似。</p>
<table>
<thead>
<tr>
<th>类</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>ClassPool</td>
<td>ClassPool是一个存储CtClass的容器，如果调用<code>get</code>方法会搜索并创建一个表示该类的CtClass对象</td>
</tr>
<tr>
<td>CtClass</td>
<td>CtClass表示的是从ClassPool获取的类对象，可对该类就行读写编辑等操作</td>
</tr>
<tr>
<td>CtMethod</td>
<td>可读写的类方法对象</td>
</tr>
<tr>
<td>CtConstructor</td>
<td>可读写的类构造方法对象</td>
</tr>
<tr>
<td>CtField</td>
<td>可读写的类成员变量对象</td>
</tr>
</tbody></table>
<p><code>Javassist</code>使用了内置的标识符来表示一些特定的含义，如：<code>$_</code>表示返回值。我们可以在动态插入类代码的时候使用这些特殊的标识符来表示对应的对象。</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>$0, $1, $2, ...</code></td>
<td><code>this</code>和方法参数</td>
</tr>
<tr>
<td><code>$args</code></td>
<td><code>Object[]</code>类型的参数数组</td>
</tr>
<tr>
<td><code>$$</code></td>
<td>所有的参数，如<code>m($$)</code>等价于<code>m($1,$2,...)</code></td>
</tr>
<tr>
<td><code>$cflow(...)</code></td>
<td>cflow变量</td>
</tr>
<tr>
<td><code>$r</code></td>
<td>返回类型，用于类型转换</td>
</tr>
<tr>
<td><code>$w</code></td>
<td>包装类型，用于类型转换</td>
</tr>
<tr>
<td><code>$_</code></td>
<td>方法返回值</td>
</tr>
<tr>
<td><code>$sig</code></td>
<td>方法签名，返回<code>java.lang.Class[]</code>数组类型</td>
</tr>
<tr>
<td><code>$type</code></td>
<td>返回值类型，<code>java.lang.Class</code>类型</td>
</tr>
<tr>
<td><code>$class</code></td>
<td>当前类，<code>java.lang.Class</code>类型</td>
</tr>
</tbody></table>
<blockquote>
<ul>
<li>方法签名</li>
</ul>
<p>Java 的方法签名是<strong>方法名称</strong>与<strong>参数类型列表（按顺序、数量）</strong>的组合，它<strong>唯一标识</strong>该方法在类中的身份。它<strong>不包含</strong>返回值类型、访问修饰符（如 <code>public</code>）、异常声明或参数名称。正是基于方法签名，Java 能够实现<strong>方法重载</strong>——允许同一个类中出现多个同名但参数列表不同的方法。<strong>简单来说，它就是 <code>方法名(参数类型1, 参数类型2, ...)</code> 的形式。</strong></p>
</blockquote>
<h2 id="7-2-读取类-成员变量-方法信息"><a href="#7-2-读取类-成员变量-方法信息" class="headerlink" title="7.2 读取类/成员变量/方法信息"></a>7.2 读取类/成员变量/方法信息</h2><p><code>Javassist</code>读取类信息非常简单，使用<code>ClassPool</code>对象获取到<code>CtClass</code>对象后就可以像使用Java反射API一样去读取类信息了。</p>
<p><strong>Javassist读取类信息示例代码：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span>javassist</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavassistClassAccessTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建ClassPool对象</span>
        <span class="token class-name">ClassPool</span> classPool <span class="token operator">=</span> <span class="token class-name">ClassPool</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">CtClass</span> ctClass <span class="token operator">=</span> classPool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"com.anbai.sec.bytecode.TestHelloWorld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                    <span class="token string">"解析类名："</span> <span class="token operator">+</span> ctClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，父类："</span> <span class="token operator">+</span> ctClass<span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                            <span class="token string">"，实现接口："</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>ctClass<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 获取所有的构造方法</span>
            <span class="token class-name">CtConstructor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ctConstructors <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredConstructors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 获取所有的成员变量</span>
            <span class="token class-name">CtField</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ctFields <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 获取所有的成员方法</span>
            <span class="token class-name">CtMethod</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ctMethods <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 输出所有的构造方法</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CtConstructor</span> ctConstructor <span class="token operator">:</span> ctConstructors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ctConstructor<span class="token punctuation">.</span><span class="token function">getMethodInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 输出所有成员变量</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CtField</span> ctField <span class="token operator">:</span> ctFields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ctField<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 输出所有的成员方法</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CtMethod</span> ctMethod <span class="token operator">:</span> ctMethods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ctMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>程序执行结果：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">解析类名：<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span></span>TestHelloWorld</span>，父类：<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span>，实现接口：<span class="token punctuation">[</span><span class="token class-name"><span class="token namespace">javassist<span class="token punctuation">.</span></span>CtClassType</span><span class="token annotation punctuation">@60addb54</span><span class="token punctuation">[</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">interface</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> fields<span class="token operator">=</span> constructors<span class="token operator">=</span> methods<span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span></span>TestHelloWorld</span><span class="token punctuation">.</span>serialVersionUID<span class="token operator">:</span><span class="token class-name">J</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span></span>TestHelloWorld</span><span class="token punctuation">.</span>id<span class="token operator">:</span><span class="token class-name">J</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span></span>TestHelloWorld</span><span class="token punctuation">.</span>username<span class="token operator">:</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span></span>TestHelloWorld</span><span class="token punctuation">.</span>password<span class="token operator">:</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token class-name"><span class="token namespace">javassist<span class="token punctuation">.</span></span>CtMethod</span><span class="token annotation punctuation">@ca717109</span><span class="token punctuation">[</span><span class="token keyword">public</span> hello <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">]</span>
<span class="token class-name"><span class="token namespace">javassist<span class="token punctuation">.</span></span>CtMethod</span><span class="token annotation punctuation">@44a4fe33</span><span class="token punctuation">[</span><span class="token keyword">public</span> <span class="token keyword">static</span> main <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token punctuation">]</span>
<span class="token class-name"><span class="token namespace">javassist<span class="token punctuation">.</span></span>CtMethod</span><span class="token annotation punctuation">@fb809fd2</span><span class="token punctuation">[</span><span class="token keyword">public</span> getId <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">J</span><span class="token punctuation">]</span>
<span class="token class-name"><span class="token namespace">javassist<span class="token punctuation">.</span></span>CtMethod</span><span class="token annotation punctuation">@5321790a</span><span class="token punctuation">[</span><span class="token keyword">public</span> setId <span class="token punctuation">(</span><span class="token class-name">J</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token punctuation">]</span>
<span class="token class-name"><span class="token namespace">javassist<span class="token punctuation">.</span></span>CtMethod</span><span class="token annotation punctuation">@7a2b684d</span><span class="token punctuation">[</span><span class="token keyword">public</span> getUsername <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">]</span>
<span class="token class-name"><span class="token namespace">javassist<span class="token punctuation">.</span></span>CtMethod</span><span class="token annotation punctuation">@7942008f</span><span class="token punctuation">[</span><span class="token keyword">public</span> setUsername <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token punctuation">]</span>
<span class="token class-name"><span class="token namespace">javassist<span class="token punctuation">.</span></span>CtMethod</span><span class="token annotation punctuation">@3b463cd2</span><span class="token punctuation">[</span><span class="token keyword">public</span> getPassword <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">]</span>
<span class="token class-name"><span class="token namespace">javassist<span class="token punctuation">.</span></span>CtMethod</span><span class="token annotation punctuation">@da549dd4</span><span class="token punctuation">[</span><span class="token keyword">public</span> setPassword <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token punctuation">]</span>
<span class="token class-name"><span class="token namespace">javassist<span class="token punctuation">.</span></span>CtMethod</span><span class="token annotation punctuation">@69cb6c6d</span><span class="token punctuation">[</span><span class="token keyword">public</span> toString <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="7-3-修改类方法"><a href="#7-3-修改类方法" class="headerlink" title="7.3 修改类方法"></a>7.3 修改类方法</h2><p><code>Javassist</code>实现类方法修改比ASM简单多了，我们只需要调用<code>CtMethod</code>类的对应的API就可以了。<code>CtMethod</code>提供了类方法修改的API，如：<code>setModifiers</code>可修改类的访问修饰符，<code>insertBefore</code>和<code>insertAfter</code>能够实现在类方法执行的前后插入任意的Java代码片段，<code>setBody</code>可以修改整个方法的代码等。</p>
<p><strong>Javassist修改类方法示例代码：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span>javassist</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">ClassPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtClass</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtMethod</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">Modifier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>javaweb<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">FileUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavassistClassModifyTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建ClassPool对象</span>
        <span class="token class-name">ClassPool</span> classPool <span class="token operator">=</span> <span class="token class-name">ClassPool</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">CtClass</span> ctClass <span class="token operator">=</span> classPool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"com.anbai.sec.bytecode.TestHelloWorld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 获取hello方法</span>
            <span class="token class-name">CtMethod</span> helloMethod <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CtClass</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>classPool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"java.lang.String"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 修改方法的访问权限为private</span>
            helloMethod<span class="token punctuation">.</span><span class="token function">setModifiers</span><span class="token punctuation">(</span><span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token constant">PRIVATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 输出hello方法的content参数值</span>
            helloMethod<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token string">"System.out.println($1);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 输出hello方法的返回值</span>
            helloMethod<span class="token punctuation">.</span><span class="token function">insertAfter</span><span class="token punctuation">(</span><span class="token string">"System.out.println($_); return \"Return:\" + $_;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">File</span> classFilePath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"javaweb-sec-source/javase/src/main/java/com/anbai/sec/bytecode/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"TestHelloWorld.class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 使用类CtClass，生成类二进制</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">toBytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 将class二进制内容写入到类文件</span>
            <span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">writeByteArrayToFile</span><span class="token punctuation">(</span>classFilePath<span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>程序执行后结果如下：</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201027174632764.png" style="zoom:50%;">

<h2 id="7-4-动态创建Java类二进制"><a href="#7-4-动态创建Java类二进制" class="headerlink" title="7.4 动态创建Java类二进制"></a>7.4 动态创建Java类二进制</h2><p><code>Javassist</code>可以像ASM一样动态的创建出一个类的二进制，不过使用<code>Javassist</code>可比ASM简单了不少，假设我们需要生成一个<code>JavassistHelloWorld</code>类，代码如下：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span>javassist</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavassistHelloWorld</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">"Hello world~"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>使用Javassist生成类字节码示例：</strong></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span>javassist</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">ClassPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtClass</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtField</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtMethod</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>javaweb<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">FileUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavassistTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建ClassPool对象</span>
        <span class="token class-name">ClassPool</span> classPool <span class="token operator">=</span> <span class="token class-name">ClassPool</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用ClassPool创建一个JavassistHelloWorld类</span>
        <span class="token class-name">CtClass</span> ctClass <span class="token operator">=</span> classPool<span class="token punctuation">.</span><span class="token function">makeClass</span><span class="token punctuation">(</span><span class="token string">"com.anbai.sec.bytecode.javassist.JavassistHelloWorld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 创建类成员变量content</span>
            <span class="token class-name">CtField</span> ctField <span class="token operator">=</span> <span class="token class-name">CtField</span><span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">"private static String content = \"Hello world~\";"</span><span class="token punctuation">,</span> ctClass<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 将成员变量添加到ctClass对象中</span>
            ctClass<span class="token punctuation">.</span><span class="token function">addField</span><span class="token punctuation">(</span>ctField<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 创建一个主方法并输出content对象值</span>
            <span class="token class-name">CtMethod</span> ctMethod <span class="token operator">=</span> <span class="token class-name">CtMethod</span><span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span>
                    <span class="token string">"public static void main(String[] args) {System.out.println(content);}"</span><span class="token punctuation">,</span> ctClass
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 将成员方法添加到ctClass对象中</span>
            ctClass<span class="token punctuation">.</span><span class="token function">addMethod</span><span class="token punctuation">(</span>ctMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">File</span> classFilePath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"javaweb-sec-source/javase/src/main/java/com/anbai/sec/bytecode/javassist/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"JavassistHelloWorld.class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 使用类CtClass，生成类二进制</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">toBytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 将class二进制内容写入到类文件</span>
            <span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">writeByteArrayToFile</span><span class="token punctuation">(</span>classFilePath<span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="7-5-Java-class反编译"><a href="#7-5-Java-class反编译" class="headerlink" title="7.5 Java class反编译"></a>7.5 Java class反编译</h2><p>在渗透测试的时候需要审计的代码通常是<code>class文件</code>或者<code>jar包</code>，在没有源文件的情况下我们可以通过反编译<code>class/jar</code>的方式阅读程序逻辑。</p>
<p>Java源码就是未经编译的<code>.java</code>文件，我们可以很轻松的阅读其中的代码逻辑，而字节码<code>.class</code>文件则是<code>.java</code>文件经过编译之后产生的无法直接阅读的二进制文件，不过我们可以通过反编译工具将<code>class文件</code>反编译成<code>java源文件</code>。我们通常会使用到<a target="_blank" rel="noopener" href="http://jd.benow.ca/">JD-GUI</a>、<a target="_blank" rel="noopener" href="https://github.com/Col-E/Recaf">Recaf</a>、<a target="_blank" rel="noopener" href="https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine/src/org/jetbrains/java/decompiler">IDEA Fernflower插件</a>、<a target="_blank" rel="noopener" href="https://github.com/Konloch/bytecode-viewer/releases">Bytecode-Viewer</a>/<a target="_blank" rel="noopener" href="https://the.bytecode.club/showthread.php?tid=5">Fernflower</a>、<a target="_blank" rel="noopener" href="http://www.javadecompilers.com/jad">JAD</a>、<a target="_blank" rel="noopener" href="http://www.cs.ioc.ee/~ando/jbe/">JBE</a>、<a target="_blank" rel="noopener" href="https://github.com/GraxCode/Cafebabe">Cafebabe</a>、<a target="_blank" rel="noopener" href="https://github.com/GraxCode/JByteMod-Beta">JByteMod</a>、<a target="_blank" rel="noopener" href="https://github.com/ingokegel/jclasslib">jclasslib</a>等工具来反编译/分析<code>class文件</code>。</p>
<p>当然，反编译工具很多时候也不是万能的，<code>JD-GUI</code>经常遇到无法反编译或反编译过程中程序直接崩溃的情况，遇到这类情况我们通常可以使用<code>IDEA</code>反编译试试，如果<code>IDEA</code>也无法反编译可以使用<code>JBE</code>或者<code>JDK</code>自带的<code>javap命令</code>来读取<code>class类字节码</code>，如果连<code>javap</code>都无法识别该<code>class文件</code>，那么这个类可能存在无法编译问题，也有可能类文件被加密处理过(自定义<code>ClassLoader</code>来<code>loadClass</code>加密后的类、或者借助<code>JNI</code>、<code>JVMTI</code>调用动态链接库)。</p>
<h3 id="7-5-1-javap"><a href="#7-5-1-javap" class="headerlink" title="7.5.1 javap"></a>7.5.1 javap</h3><p><code>javap</code>是JDK自带的一个命令行反汇编工具，命令行参数如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">用法: javap <span class="token operator">&lt;</span>options<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>classes<span class="token operator">&gt;</span>
其中, 可能的选项包括:
  <span class="token parameter variable">-help</span>  <span class="token parameter variable">--help</span>  -?        输出此用法消息
  <span class="token parameter variable">-version</span>                 版本信息
  <span class="token parameter variable">-v</span>  <span class="token parameter variable">-verbose</span>             输出附加信息
  <span class="token parameter variable">-l</span>                       输出行号和本地变量表
  <span class="token parameter variable">-public</span>                  仅显示公共类和成员
  <span class="token parameter variable">-protected</span>               显示受保护的/公共类和成员
  <span class="token parameter variable">-package</span>                 显示程序包/受保护的/公共类
                           和成员 <span class="token punctuation">(</span>默认<span class="token punctuation">)</span>
  <span class="token parameter variable">-p</span>  <span class="token parameter variable">-private</span>             显示所有类和成员
  <span class="token parameter variable">-c</span>                       对代码进行反汇编
  <span class="token parameter variable">-s</span>                       输出内部类型签名
  <span class="token parameter variable">-sysinfo</span>                 显示正在处理的类的
                           系统信息 <span class="token punctuation">(</span>路径, 大小, 日期, MD5 散列<span class="token punctuation">)</span>
  <span class="token parameter variable">-constants</span>               显示最终常量
  <span class="token parameter variable">-classpath</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>        指定查找用户类文件的位置
  <span class="token parameter variable">-cp</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>               指定查找用户类文件的位置
  <span class="token parameter variable">-bootclasspath</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>    覆盖引导类文件的位置<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>查看类字节码</li>
</ul>
<p>可根据javap命令控制输出信息，如：<code>javap -c -l TestHelloWorld.class</code>可显示类方法的字节码信息，如下图：</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019180336096.png" style="zoom:67%;">

<p>如果想要获取到详细的类信息可使用<code>-v</code>参数。</p>
<h3 id="7-5-2-jd-GUI"><a href="#7-5-2-jd-GUI" class="headerlink" title="7.5.2 jd-GUI"></a>7.5.2 jd-GUI</h3><p><code>JD-GUI</code>使用纯Java编写，使用的反编译实现是<a target="_blank" rel="noopener" href="https://github.com/java-decompiler/jd-core">jd-core</a>，支持<code>JDK 1.1.8 - Java 12</code>，支持<code>Lambda表达式</code>、<code>方法引用</code>、<code>默认方法</code>等特性，是一款非常简单易用的反编译工具。</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019111635786.png" style="zoom:67%;">

<p><code>JD-GUI</code>在反编译的时候还会主动关联<code>Maven</code>仓库，如果反编译的jar在maven仓库中存在会自动下载类源码，如下图：</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019111844349.png" style="zoom:67%;">

<p>字符串搜索：</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019142922249.png" style="zoom:67%;">

<p><code>JD-GUI</code>支持批量反编译，在菜单中点击<code>File</code>–&gt;<code>Save All Sources</code>即可反编译整个jar文件，如下图：</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019152122562.png" style="zoom:50%;">

<p>除此之外，<code>JD-GUI</code>还有Eclipse和IDEA的插件：<a target="_blank" rel="noopener" href="http://java-decompiler.github.io/%E3%80%81https://plugins.jetbrains.com/plugin/7100-java-decompiler-intellij-plugin%E3%80%82">http://java-decompiler.github.io/、https://plugins.jetbrains.com/plugin/7100-java-decompiler-intellij-plugin。</a></p>
<p>官方网站：<a target="_blank" rel="noopener" href="http://java-decompiler.github.io/">http://java-decompiler.github.io/</a></p>
<p>Github：<a target="_blank" rel="noopener" href="https://github.com/java-decompiler/jd-gui">https://github.com/java-decompiler/jd-gui</a></p>
<p>反编译jd-core：<a target="_blank" rel="noopener" href="https://github.com/java-decompiler/jd-core">https://github.com/java-decompiler/jd-core</a></p>
<p>版本下载：<a target="_blank" rel="noopener" href="https://github.com/java-decompiler/jd-gui/releases">https://github.com/java-decompiler/jd-gui/releases</a></p>
<h3 id="7-5-3-Recaf"><a href="#7-5-3-Recaf" class="headerlink" title="7.5.3 Recaf"></a>7.5.3 Recaf</h3><p><a target="_blank" rel="noopener" href="https://github.com/Col-E/Recaf">Recaf</a>是一个使用<code>JavaFX</code>开发的现代化反编译工具，它不但具备编译功能，而且还可以直接直接编辑反编译后的类文件、查看字节码、Hex编辑、中文支持等丰富功能。</p>
<ul>
<li>编辑模式</li>
</ul>
<p><code>Recaf</code>默认使用的是反编译模式，可根据需求选择为Hex或者Table模式，如下图：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019140224424.png" alt="img"></p>
<ul>
<li>反编译模式</li>
</ul>
<p><code>Recaf</code>的默认编辑视图是反编译模式，如果使用的是JDK运行的<code>Recaf</code>，还可以直接编辑反编译后的class文件，如下图：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019113213048.png" alt="image-20201019113213048"></p>
<ul>
<li>Hex模式编辑</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019135516449.png" alt="image-20201019135516449"></p>
<ul>
<li>Table模式/字节码编辑</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019135811893.png" alt="img"></p>
<ul>
<li>字节码编辑：</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019135923429.png" alt="img"></p>
<ul>
<li>Java Agent/Attach模式</li>
</ul>
<p><code>Recaf</code>支持<code>Agent模式</code>或者<code>attach模式</code>（注入）。</p>
<ul>
<li>Agent Attach模式</li>
</ul>
<p>在菜单栏中点击<code>注入</code>菜单，选择<code>Running process</code>可以看到本机所有运行的Java进程，如下图：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019142224784.png" alt="img"></p>
<p><code>attach</code>模式可附加<code>Recaf</code>到一个指定的JVM进程：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019140022294.png" alt="img"></p>
<ul>
<li>Agent模式</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/Col-E/Recaf/issues/31">Agent模式</a>需要在启动<code>Recaf</code>的时候指定<code>-javaagent:</code>参数，如下图，以<code>Agent模式</code>启动<code>Recaf</code>，启动完成后会弹出一个<code>Recaf Instrumentation</code>的窗体：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019142104679.png" alt="image-20201019142104679"></p>
<ul>
<li>字符串搜索</li>
</ul>
<p><code>Recaf</code>支持很多种搜索方式，如下图：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019143255436.png" alt="img"></p>
<p>字符串搜索测试：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019143217542.png" alt="img"></p>
<p>详细文档：<a target="_blank" rel="noopener" href="https://www.coley.software/Recaf/doc-setup-get.html">https://www.coley.software/Recaf/doc-setup-get.html</a></p>
<p>Github：<a target="_blank" rel="noopener" href="https://github.com/Col-E/Recaf">https://github.com/Col-E/Recaf</a></p>
<p>版本下载：<a target="_blank" rel="noopener" href="https://github.com/Col-E/Recaf/releases">https://github.com/Col-E/Recaf/releases</a></p>
<h3 id="7-5-4-FernFlower-IDEA"><a href="#7-5-4-FernFlower-IDEA" class="headerlink" title="7.5.4 FernFlower/IDEA"></a>7.5.4 FernFlower/IDEA</h3><p><code>Fernflower</code>是一个简单高效的反编译命令行工具，<code>Fernflower</code>已成为了<code>JetBrains</code>的<code>intellij-community</code>内置反编译工具，同时<code>Fernflower</code>还有一个非常好用的GUI工具： <code>Bytecode Viewer</code>。</p>
<p><strong><code>Fernflower</code>反编译jar示例：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">java -jar fernflower.jar jarToDecompile.jar decomp/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中<code>jarToDecompile.jar</code>是需要反编译的jar文件，<code>decomp</code>是反编译后的<code>class文件</code>所存放的目录。需要注意的是<code>Fernflower</code>如遇无法反编译的情况可能会生成空的java文件！</p>
<ul>
<li>使用Find命令和Fernflower实现批量反编译jar</li>
</ul>
<p>通常我们在某些特殊的场景下拿到的只是jar文件，那么我们应该如何反编译整个jar包的class文件呢？</p>
<p><code>find</code>命令并不能支持Java反编译，但是<code>find</code>命令可以非常方便的搜索经过编译后的二进制文件中的内容，所以有的时候使用<code>find</code>命令通常是最简单实用的。例如使用<code>find</code>命令搜索某个关键字： <code>find ./ -type f -name "*.class" |xargs grep XXXX</code> 。</p>
<p>有的时候我们只有项目war包没有源码，只能在<code>WEB-INF/lib</code>中找程序的源码，这个时候我们可以巧妙的使用<code>find</code>命令加<code>Fernflower</code>来实现反编译所有的jar包。</p>
<p>这里以<code>jcms</code>的一个非常老版本为例,<code>jcms</code>最终给客户部署的war包中源码并不是在<code>WEB-INF/classes</code>目录下，而是将整个<code>jcms</code>系统按模块打包成了多个jar包放在了<code>WEB-INF/lib</code>目录下。我们可以通过搜索<code>com.hanweb</code>包名称来找出所有jar中包含了<code>jcms</code>的文件并通过<code>Fernflower</code>来反编译。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> /Users/yz/Desktop/javaweb-decomplier/javaweb-decomplier.jar <span class="token parameter variable">-dgs</span><span class="token operator">=</span><span class="token number">1</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> /Users/yz/Desktop/jcms/WEB-INF/lib/ <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">"*.jar"</span> <span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">grep</span> <span class="token string">"com.hanweb"</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $3}'</span><span class="token variable">)</span></span> /Users/yz/jcms-decomplier<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>执行上面的命令后会在<code>jcms-decomplier</code>目录下看到所有的jar已经被<code>Fernflower</code>反编译了。</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/4.2.jpeg" alt="img"></p>
<p>依赖的jar: <a target="_blank" rel="noopener" href="https://github.com/javaweb-sec/javaweb-decomplier">javaweb-decomplier</a>、<a target="_blank" rel="noopener" href="https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine">Intellij java-decompiler</a>。</p>
<p>Github：<a target="_blank" rel="noopener" href="https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine/src/org/jetbrains/java/decompiler">https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine/src/org/jetbrains/java/decompiler</a></p>
<p>Fernflower文档：<a target="_blank" rel="noopener" href="https://the.bytecode.club/fernflower.txt">https://the.bytecode.club/fernflower.txt</a></p>
<h3 id="7-5-5-IDEA反编译"><a href="#7-5-5-IDEA反编译" class="headerlink" title="7.5.5 IDEA反编译"></a>7.5.5 IDEA反编译</h3><p><code>IDEA</code>自带的反编译工具<code>FernFlower</code>，在IDEA中可以直接打开class文件，默认将使用<code>FernFlower</code>反编译，如下图：</p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019143701601.png" style="zoom:67%;">

<p>IDEA支持class文件名(<code>⇧⌘F</code>)、类方法名称(<code>⇧⌘O</code>)搜索。</p>
<h3 id="7-5-6-Bytecode-Viewer"><a href="#7-5-6-Bytecode-Viewer" class="headerlink" title="7.5.6 Bytecode Viewer"></a>7.5.6 Bytecode Viewer</h3><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019145310008.png" alt="img"></p>
<p><code>Bytecode Viewer</code>是一个基于<code>FernFlower</code>实现的轻量级，用户友好的Java字节码可视化工具，<code>Bytecode Viewer</code>具备了如下强大功能：</p>
<ol>
<li>Java 反编译GUI；</li>
<li><code>Bytecode</code>编辑器 GUI；</li>
<li><code>Smali</code> GUI ；</li>
<li><code>Baksmali</code> GUI；</li>
<li><code>APK</code>编辑器 GUI；</li>
<li><code>Dex</code>编辑器 GUI；</li>
<li><code>APK</code>反编译 GUI；</li>
<li><code>DEX</code>反编译 GUI；</li>
<li><code>Procyon</code> Java反编译 GUI；</li>
<li><code>Krakatau</code> GUI；</li>
<li><code>CFR</code> Java反编译 GUI；</li>
<li><code>FernFlower</code> Java反编译 GUI；</li>
<li><code>DEX2Jar</code> GUI；</li>
<li><code>Jar2DEX</code> GUI；</li>
<li><code>Jar-Jar</code> GUI；</li>
<li><code>Hex</code>视图；</li>
<li>代码搜索；</li>
<li>调试器；</li>
</ol>
<ul>
<li>多视图</li>
</ul>
<p><code>Bytecode Viewer</code>提供了多种视图可供选择，在<code>View</code>菜单中可选择不同的视图或反编译引擎（默认使用的是反编译和字节码视图），当选择了<code>Editable</code>后可编辑反编译后的class文件，如下图：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019151037905.png" alt="image-20201019151037905"></p>
<ul>
<li>代码搜索功能</li>
</ul>
<p>代码搜索功能支持字符串、正则表达式、调用方法和调用字段搜索，如下图：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019154032388.png" alt="img"></p>
<ul>
<li>反编译安卓APK</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019151742200.png" alt="image-20201019151742200"></p>
<p>Github：<a target="_blank" rel="noopener" href="https://github.com/Konloch/bytecode-viewer">https://github.com/Konloch/bytecode-viewer</a></p>
<p>版本下载：<a target="_blank" rel="noopener" href="https://github.com/Konloch/bytecode-viewer/releases">https://github.com/Konloch/bytecode-viewer/releases</a></p>
<h3 id="7-5-7-jad"><a href="#7-5-7-jad" class="headerlink" title="7.5.7 jad"></a>7.5.7 jad</h3><p><code>jad</code>是一个C++编写的跨平台的Java反编译命令行工具，可使用<code>jad</code>命令反编译class文件，<code>jad</code>最新版本是发布于2006年的<code>1.5.8g</code>，距今，已有14年没更新了。</p>
<p>反编译示例：<code>jad TestHelloWorld.class</code></p>
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019160840290.png" style="zoom:50%;">

<p><code>JAD</code>参数如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Jad accepts the following options:

<span class="token parameter variable">-a</span>       - annotate the output with JVM bytecodes <span class="token punctuation">(</span>default: off<span class="token punctuation">)</span>
<span class="token parameter variable">-af</span>      - same as -a, but output fully qualified names when annotating
<span class="token parameter variable">-clear</span>   - <span class="token function">clear</span> all prefixes, including the default ones <span class="token punctuation">(</span>can be abbreviated as -cl<span class="token punctuation">)</span>
<span class="token parameter variable">-b</span>       - output redundant braces <span class="token punctuation">(</span>e.g., if<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span> b<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>, default: off<span class="token punctuation">)</span>
<span class="token parameter variable">-d</span> 
 - directory <span class="token keyword">for</span> output files <span class="token punctuation">(</span>will be created when necessary<span class="token punctuation">)</span>
  <span class="token parameter variable">-dead</span>    - try to decompile dead parts of code <span class="token punctuation">(</span>if any<span class="token punctuation">)</span> <span class="token punctuation">(</span>default: off<span class="token punctuation">)</span>
  <span class="token parameter variable">-disass</span>  - disassemble method bytecodes <span class="token punctuation">(</span>no JAVA <span class="token builtin class-name">source</span> generated<span class="token punctuation">)</span>
  <span class="token parameter variable">-f</span>       - output fully qualified names <span class="token keyword">for</span> classes/fields/methods <span class="token punctuation">(</span>default: off<span class="token punctuation">)</span>
  <span class="token parameter variable">-ff</span>      - output class fields before methods <span class="token punctuation">(</span>default: after methods<span class="token punctuation">)</span>
  <span class="token parameter variable">-i</span>       - output default initializers <span class="token keyword">for</span> all non-final fields
  <span class="token parameter variable">-l</span>  - <span class="token function">split</span> strings into pieces of maximum  chars <span class="token punctuation">(</span>default: off<span class="token punctuation">)</span>
  <span class="token parameter variable">-lnc</span>     - annotate the output with line numbers <span class="token punctuation">(</span>default: off<span class="token punctuation">)</span>
  <span class="token parameter variable">-lradix</span> - display long integers using the specified radix <span class="token punctuation">(</span><span class="token number">8</span>, <span class="token number">10</span> or <span class="token number">16</span><span class="token punctuation">)</span>
  <span class="token parameter variable">-nl</span>      - <span class="token function">split</span> strings on newline character <span class="token punctuation">(</span>default: off<span class="token punctuation">)</span>
  <span class="token parameter variable">-nocast</span>  - don<span class="token string">'t generate auxiliary casts
  -nocode  - don'</span>t generate the <span class="token builtin class-name">source</span> code <span class="token keyword">for</span> methods
  <span class="token parameter variable">-noconv</span>  - don<span class="token string">'t convert Java identifiers (default: convert)
  -noctor  - suppress the empty constructors
  -nodos   - do not check for class files written in DOS mode (CR before NL, default: check)
  -nofd    - don'</span>t disambiguate fields with the same names by adding signatures to their names <span class="token punctuation">(</span>default: <span class="token keyword">do</span><span class="token punctuation">)</span>
  <span class="token parameter variable">-noinner</span> - turn off the support of inner classes <span class="token punctuation">(</span>default: on<span class="token punctuation">)</span>
  <span class="token parameter variable">-nolvt</span>   - ignore Local Variable Table information
  <span class="token parameter variable">-nonlb</span>   - don<span class="token string">'t output a newline before opening brace (default: do)
  -o       - overwrite output files without confirmation (default: off)
  -p       - send decompiled code to STDOUT (e.g., for piping)
  -pi - pack imports into one line after  imports (default: 3)
  -pv - pack fields with identical types into one line (default: off)
  -pa - prefix for all packages in generated source files
  -pc - prefix for classes with numerical names (default: _cls)
  -pf - prefix for fields with numerical names (default: _fld)
  -pe - prefix for unused exception names (default: _ex)
  -pl - prefix for locals with numerical names (default: _lcl)
  -pm - prefix for methods with numerical names (default: _mth)
  -pp - prefix for method parms with numerical names (default: _prm)
  -r       - restore package directory structrure
  -radix - display integers using the specified radix (8, 10 or 16)
  -s  - output file extension (by default '</span>.jad'<span class="token punctuation">)</span>
  <span class="token parameter variable">-safe</span>    - generate additional casts to disambiguate methods/fields <span class="token punctuation">(</span>default: off<span class="token punctuation">)</span>
  <span class="token parameter variable">-space</span>   - output space between keyword <span class="token punctuation">(</span>if/for/while/etc<span class="token punctuation">)</span> and expression <span class="token punctuation">(</span>default: off<span class="token punctuation">)</span>
  <span class="token parameter variable">-stat</span>    - display the total number of processed classes/methods/fields
  <span class="token parameter variable">-t</span>       - use tabs instead of spaces <span class="token keyword">for</span> indentation
  <span class="token parameter variable">-t</span>  - use  spaces <span class="token keyword">for</span> indentation <span class="token punctuation">(</span>default: <span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token parameter variable">-v</span>       - display method names being decompiled
  <span class="token parameter variable">-8</span>       - convert UNICODE strings into <span class="token number">8</span>-bit strings
  using the current ANSI code page <span class="token punctuation">(</span>Win32 only<span class="token punctuation">)</span>
  -<span class="token operator">&amp;</span>       - redirect STDERR to STDOUT <span class="token punctuation">(</span>Win32 only<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>官方网站：<a target="_blank" rel="noopener" href="http://www.kpdus.com/jad.html#general">http://www.kpdus.com/jad.html#general</a></p>
<p>版本下载：<a target="_blank" rel="noopener" href="http://www.javadecompilers.com/jad">http://www.javadecompilers.com/jad</a></p>
<h3 id="7-5-8-JBE"><a href="#7-5-8-JBE" class="headerlink" title="7.5.8 JBE"></a>7.5.8 JBE</h3><p><code>JBE(Java Bytecode Editor)</code>是一个使用<a target="_blank" rel="noopener" href="http://jakarta.apache.org/bcel/">BCEL</a>和<a target="_blank" rel="noopener" href="http://www.ej-technologies.com/products/jclasslib/overview.html">jclasslib bytecode viewer</a>实现的编辑class字节码编辑的工具，<code>JBE</code>只能编辑字节码，不能反编译，<code>JBE</code>也有近10年未更新了，不支持高版本的Java class解析。</p>
<p>添加常量池对象：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019164255758.png" alt="img"></p>
<ul>
<li>删除常量池对象</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019164424942.png" alt="img"></p>
<ul>
<li>删除类成员变量</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019164800876.png" alt="img"></p>
<ul>
<li>查看字节码</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019164619458.png" alt="img"></p>
<ul>
<li>编辑字节码</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019163143075.png" alt="image-20201019163143075"></p>
<ul>
<li>删除类方法</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019164705299.png" alt="img"></p>
<p>官方地址：<a target="_blank" rel="noopener" href="https://set.ee/jbe/">https://set.ee/jbe/</a></p>
<h3 id="7-5-9-jclasslib-bytecode-viewer"><a href="#7-5-9-jclasslib-bytecode-viewer" class="headerlink" title="7.5.9 jclasslib bytecode viewer"></a>7.5.9 jclasslib bytecode viewer</h3><p><code>jclasslib</code>是一个有20年历史的java字节码浏览工具，可以非常方便的查看class的常量池、字节码等信息，非常适合学习解析class字节码。新版本的<code>jclasslib</code>支持中文，改用了<code>Kotlin</code>编写。</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019163424897.png" alt="image-20201019163424897"></p>
<p>Github：<a target="_blank" rel="noopener" href="https://github.com/ingokegel/jclasslib">https://github.com/ingokegel/jclasslib</a></p>
<p>版本下载：<a target="_blank" rel="noopener" href="https://github.com/ingokegel/jclasslib/releases">https://github.com/ingokegel/jclasslib/releases</a></p>
<h3 id="7-5-10-Cafebabe-Lite"><a href="#7-5-10-Cafebabe-Lite" class="headerlink" title="7.5.10 Cafebabe Lite"></a>7.5.10 Cafebabe Lite</h3><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019171226961.png" alt="image-20201019171226961"></p>
<p><code>Cafebabe</code>是一个用户友好的Java字节码编辑器。</p>
<ul>
<li>反编译</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019170742769.png" alt="image-20201019170742769"></p>
<ul>
<li>字节码编辑</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019171439589.png" alt="image-20201019171439589"></p>
<ul>
<li>字节码可视化</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019170935681.png" alt="img"></p>
<p><strong>Cafebabe / JByteMod / other比较：</strong></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th>reJ</th>
<th>JBytedit</th>
<th>JBE</th>
<th>Recaf</th>
<th>JByteMod</th>
<th>Cafebabe</th>
</tr>
</thead>
<tbody><tr>
<td align="right">Edit Instructions</td>
<td>部分</td>
<td>部分</td>
<td>部分</td>
<td>部分</td>
<td>Yes</td>
<td>部分</td>
</tr>
<tr>
<td align="right">Edit Fields</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td align="right">Edit Attributes</td>
<td>部分</td>
<td>部分</td>
<td>部分</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td align="right">Edit Try Catch Blocks</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td align="right">Decompiler(s)</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Analytical Decompiler</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Colored Syntax</td>
<td>No</td>
<td>Yes</td>
<td>部分</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Labels</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Multilingual support</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">LDC Search</td>
<td>部分</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td align="right">Instruction Search</td>
<td>部分</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td align="right">Regex Search</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td align="right">Class Search</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td align="right">In-Editor Search</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td align="right">In-Editor Help</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>unknown</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Frame Regeneration</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Automatic Frame Regeneration (no libraries)</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Control Flow Graph</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Java 8 Support</td>
<td>No</td>
<td>部分</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Java 11 Support</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Java 12 Support</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td align="right">Obfuscation Analysis</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td align="right">Live Code Manipulation</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody></table>
<p>Github：<a target="_blank" rel="noopener" href="https://github.com/GraxCode/Cafebabe/">https://github.com/GraxCode/Cafebabe/</a></p>
<p>版本下载：<a target="_blank" rel="noopener" href="https://github.com/GraxCode/Cafebabe/releases">https://github.com/GraxCode/Cafebabe/releases</a></p>
<h3 id="7-5-11-JByteMod"><a href="#7-5-11-JByteMod" class="headerlink" title="7.5.11 JByteMod"></a>7.5.11 JByteMod</h3><p><code>JByteMod</code>和<code>Cafebabe</code>都是同一个作者开发的，<code>JByteMod</code>在<code>Cafebabe</code>基础上做了非常多的改进，支持反编译、字节码编辑、可视化分析、Agent注入等。</p>
<ul>
<li>反编译</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019173646644.png" alt="img"></p>
<ul>
<li>字节码编辑</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019173107619.png" alt="img"></p>
<ul>
<li>字节码分析</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019174255460.png" alt="img"></p>
<ul>
<li>方法信息编辑</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019173815788.png" alt="img"></p>
<ul>
<li>方法添加/编辑</li>
</ul>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/image-20201019173247265.png" alt="img"></p>
<p>Github：<a target="_blank" rel="noopener" href="https://github.com/GraxCode/JByteMod-Beta">https://github.com/GraxCode/JByteMod-Beta</a></p>
<p>版本下载：<a target="_blank" rel="noopener" href="https://github.com/GraxCode/JByteMod-Beta/releases">https://github.com/GraxCode/JByteMod-Beta/releases</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.javasec.org/">https://www.javasec.org/</a> 【java安全】</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">KajimiYa</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://sxksec.cn/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/">http://sxksec.cn/2025/07/22/dai-ma-shen-ji/java-java-zi-jie-ma/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">KajimiYa</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">
                                    <span class="chip bg-color">Java代码审计</span>
                                </a>
                            
                                <a href="/tags/Java%E5%AD%97%E8%8A%82%E7%A0%81/">
                                    <span class="chip bg-color">Java字节码</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2025/07/23/dai-ma-shen-ji/java-agent-ji-zhi/">
                    <div class="card-image">
                        
                        
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/medias/featureimages/2.jpg" class="responsive-img" alt="Java-Agent机制">
                        
                        <span class="card-title">Java-Agent机制</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文主要介绍Java Agent的相关内容。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-07-23
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="post-category">
                                    代码审计
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">
                        <span class="chip bg-color">Java代码审计</span>
                    </a>
                    
                    <a href="/tags/Java-Agent/">
                        <span class="chip bg-color">Java Agent</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/07/22/dai-ma-shen-ji/java-jdwp-gong-ji/">
                    <div class="card-image">
                        
                        
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/medias/featureimages/6.jpg" class="responsive-img" alt="Java-JDWP攻击">
                        
                        <span class="card-title">Java-JDWP攻击</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文主要介绍Java的JDWP攻击。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-07-22
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="post-category">
                                    代码审计
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">
                        <span class="chip bg-color">Java代码审计</span>
                    </a>
                    
                    <a href="/tags/JDWP%E6%94%BB%E5%87%BB/">
                        <span class="chip bg-color">JDWP攻击</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1,h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2025</span>
            
            <a href="/about" target="_blank">Si Xiaokai</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">487.8k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/si-xiao-kai" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:284254231@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=284254231" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 284254231" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    


        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body>

</html>
